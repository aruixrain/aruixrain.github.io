<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/doc/%E5%88%86%E5%B8%83%E5%BC%8F/cloud/SpringCloud%202.html"><meta property="og:title" content="SpringCloud 2"><meta property="og:description" content="image-20230306230950443image-20230306230950443 å¾®æœåŠ¡è¿›é˜¶ å‰é¢æˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºNetflixçš„è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Šæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œæ¥çœ‹çœ‹ç›®å‰æˆ‘ä»¬æ‰€è®¤è¯†åˆ°çš„SpringCloudå„å¤§ç»„ä»¶çš„ç»´æŠ¤æƒ…å†µï¼š æ³¨å†Œä¸­å¿ƒï¼š Eurekaï¼ˆå±äºNetflixï¼Œ2.xç‰ˆæœ¬ä¸å†å¼€æº..."><meta property="og:type" content="article"><meta property="og:image" content="https://s2.loli.net/2023/03/06/V1dFqQMR7T2GzSJ.png"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Cotton Eye Joe"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"SpringCloud 2","image":["https://s2.loli.net/2023/03/06/V1dFqQMR7T2GzSJ.png","https://s2.loli.net/2023/03/06/pQkSrLx9NZRn8Ub.png","https://s2.loli.net/2023/03/06/VStPIABaXxMp2N9.png","https://s2.loli.net/2023/03/06/wWbuXRGizrQCT8J.png","https://s2.loli.net/2023/03/06/bM8doEZPth7DHfe.png","https://s2.loli.net/2023/03/06/O3pMSvDbxPKYT5q.png","https://s2.loli.net/2023/03/06/sbKTUqhLViIfrmR.png","https://s2.loli.net/2023/03/06/dom3WpJsiajgCE7.png","https://s2.loli.net/2023/03/06/9PLBGOXoaERnUwM.png","https://s2.loli.net/2023/03/06/K6VBtqEWSLnMp21.png","https://s2.loli.net/2023/03/06/HIGvXAad1EOVPt6.png","https://s2.loli.net/2023/03/06/WZGdJ5BYpmbMuNT.png","https://s2.loli.net/2023/03/06/GCrm8wgWXLzYhtK.png","https://s2.loli.net/2023/03/06/p6iYrPa8e1btZkl.png","https://s2.loli.net/2023/03/06/jCl8RGhaIiUDBgm.png","https://s2.loli.net/2023/03/06/2bWdfmnVOyGzlZr.png","https://s2.loli.net/2023/03/06/cF5MoVX6vNnzx9j.png","https://s2.loli.net/2023/03/06/FdRTjlKszDoOPU3.png","https://s2.loli.net/2023/03/06/R5Jyhl29UcvuOCb.png","https://s2.loli.net/2023/03/06/szyGRrEfZ1KWmpj.png","https://s2.loli.net/2023/03/06/wlO9dQ1NtKCxFTi.png","https://s2.loli.net/2023/03/06/cwIhdCMmATELvlN.png","https://s2.loli.net/2023/03/06/jrYo3epaLMyQnu4.png","https://s2.loli.net/2023/03/06/s1ko9UcD4mMQ5fW.png","https://s2.loli.net/2023/03/06/1pAckEZN5ltXKWG.png","https://s2.loli.net/2023/03/06/6j2pAmdfyIGz9Cu.png","https://s2.loli.net/2023/03/06/7ACoW3txIsjLzu2.png","https://s2.loli.net/2023/03/06/alFpWGfNejImQEw.png","https://s2.loli.net/2023/03/06/5J4FfMgtGwZhP3C.png","https://s2.loli.net/2023/03/06/9xthuBpgFs4PTSq.png","https://s2.loli.net/2023/03/06/kacrSVGYMpwK2jx.png","https://s2.loli.net/2023/03/06/YLC2H6yGoVi5z1f.png","https://s2.loli.net/2023/03/06/isTaOUQwMVWGCY9.png","https://s2.loli.net/2023/03/06/dR4thB5JTk1cGjm.png","https://s2.loli.net/2023/03/06/7itUIhz3NupRdr6.png","https://s2.loli.net/2023/03/06/DC2I1MvVFjYmPEq.png","https://s2.loli.net/2023/03/06/Ek4APjgGcqbitNm.png","https://s2.loli.net/2023/03/06/H1AvxOK78yspP5k.jpg","https://s2.loli.net/2023/03/06/Fuxq9Dl3rGfnTZA.png","https://s2.loli.net/2023/03/06/97suBpfdeF54rc2.png","https://s2.loli.net/2023/03/06/cf76RJ9VUiQBlje.png","https://s2.loli.net/2023/03/06/RW4JIBKVXSbG3lZ.png","https://s2.loli.net/2023/03/06/2pe51dHQsJkPVY7.png","https://s2.loli.net/2023/03/06/5CbEGQ7rX2StUkR.png","https://s2.loli.net/2023/03/06/kQF3lN24vcBqzDi.png","https://s2.loli.net/2023/03/06/PQYi69aKZUXrNlJ.png","https://s2.loli.net/2023/03/06/Lbf14V39SCdghvO.png","https://s2.loli.net/2023/03/06/gVuMlAXcY34Ka2C.png","https://s2.loli.net/2023/03/06/2hrxcizHPvSq8be.png","https://s2.loli.net/2023/03/06/gdh43ciamLnBRFV.png","https://s2.loli.net/2023/03/06/xnmustzRkFZJWIP.png","https://s2.loli.net/2023/03/06/oZdLMAJaCD3Uw9F.png","https://s2.loli.net/2023/03/06/Hjm4Z38s95YiFvI.png","https://s2.loli.net/2023/03/06/RfVAdtOqJjWlx6E.png","https://s2.loli.net/2023/03/06/QpVRTYtBX6kvj2b.png","https://s2.loli.net/2023/03/06/p4KTaDd1wc5BR92.png","https://s2.loli.net/2023/03/06/pzOus21AWqLfr9k.png","https://s2.loli.net/2023/03/06/dMZVz3kDRxYaHg5.png","https://s2.loli.net/2023/03/06/F1RxtgBZNQvWpw8.png","https://s2.loli.net/2023/03/06/XRnKgCivsqFE2ax.png","https://s2.loli.net/2023/03/06/8MyG3WDo1wSBb5Y.png","https://s2.loli.net/2023/03/06/4fPg72OJiwhDycL.png","https://s2.loli.net/2023/03/06/Lrw7ZJNzyDUoYG8.png","https://s2.loli.net/2023/03/06/E9vnJRTPZmzaW8V.png","https://s2.loli.net/2023/03/06/QgqsxdvYF59P7ne.png","https://s2.loli.net/2023/03/06/tnKXB2JUarehk5T.png","https://s2.loli.net/2023/03/06/FOzJdtoieAxIvPq.png","https://s2.loli.net/2023/03/06/UHbcgSWV2exNCu1.png","https://s2.loli.net/2023/03/06/MHiDyU54L3QsNrc.png","https://s2.loli.net/2023/03/06/PfVOQWJrTiZGqh7.png","https://s2.loli.net/2023/03/06/p1Y53LPihOGZjBV.png","https://s2.loli.net/2023/03/06/pk1HjSi9VyxwOJQ.png","https://s2.loli.net/2023/03/06/fIlhGM3jPxb7wgS.png","https://s2.loli.net/2023/03/06/hskQVKnE2y5PftO.png","https://s2.loli.net/2023/03/06/nC6W5T4OGcJNypA.png","https://s2.loli.net/2023/03/06/WVguflyZ43NxE7j.png","https://s2.loli.net/2023/03/06/oipjTJBHsMSdDvc.png","https://s2.loli.net/2023/03/06/AxrzjvtPWJ2YCZI.png","https://s2.loli.net/2023/03/06/CbYxA3d7w46OlMm.png","https://s2.loli.net/2023/03/06/gY62LD3vw157WiU.png","https://s2.loli.net/2023/03/06/7BW6LGXQNl5b1Iv.png","https://s2.loli.net/2023/03/06/ExWIKFSNpPoksiT.png","https://s2.loli.net/2023/03/06/CmdPgcqvX4a2u9p.png","https://s2.loli.net/2023/03/06/Dz3EgG9eH4UXTkJ.png","https://s2.loli.net/2023/03/06/jSp92ODTRhlxJsn.png","https://s2.loli.net/2023/03/06/FfhalnZdS2ujm1t.png","https://s2.loli.net/2023/03/06/CugOUozGA6inB3R.png","https://s2.loli.net/2023/03/06/XC1VekDfainIpv6.png","https://s2.loli.net/2023/03/06/QkofY5gzwSr6WGn.png","https://s2.loli.net/2023/03/06/5kLcAaT6wJgYXGx.png","https://s2.loli.net/2023/03/06/M2yZpJLfs1i9adC.png","https://s2.loli.net/2023/03/06/8OCeNap2Vy6X7WH.png","https://s2.loli.net/2023/03/06/AiEXC3wBflPxHGT.png","https://s2.loli.net/2023/03/06/jDAy7osQ5YIqruP.png","https://s2.loli.net/2023/03/06/TvJL2PiWFU4XoaZ.png","https://s2.loli.net/2023/03/06/WjEcGbtkNrZi1CL.png","https://s2.loli.net/2023/03/06/MPkZb1dA2Khjcty.png","https://s2.loli.net/2023/03/06/H43Fy9z76LIvJGd.png","https://s2.loli.net/2023/03/06/l9D8aXBxkvnZejw.png","https://s2.loli.net/2023/03/06/BWiUzFrjHAao1kJ.png","https://s2.loli.net/2023/03/06/LsUq3AvrfhQJPCz.png","https://s2.loli.net/2023/03/06/vLTZFS4yn26uabA.png","https://s2.loli.net/2023/03/06/ykH1BSPcxlvY4on.png","https://s2.loli.net/2023/03/06/NIe9QFW3jf1DdnV.png","https://s2.loli.net/2023/03/06/LwcdO2HuWAhFr5p.png","https://s2.loli.net/2023/03/06/6VOfsp9UxYJzgKD.png","https://s2.loli.net/2023/03/06/yEQa2qeiNc5npV9.png","https://s2.loli.net/2023/03/06/VtBlx4U1TzcqKra.png","https://s2.loli.net/2023/03/06/WXn9UPgxBVhdHmb.png","https://s2.loli.net/2023/03/06/93mXN5dlC2GTLOW.png","https://s2.loli.net/2023/03/06/1tPwBFn7u3ScCeY.png","https://s2.loli.net/2023/03/06/8yTQGZluYVe1cg2.png","https://s2.loli.net/2023/03/06/UBchb4zPjHAfCSs.png","https://s2.loli.net/2023/03/06/PSbw5TFhm74Wu3n.png","https://s2.loli.net/2023/03/06/nZUcuM2kJ86zgBv.png","https://s2.loli.net/2023/03/06/Fn3R2Jrq1YyleCh.png","https://s2.loli.net/2023/03/06/Cph9zPF2kaSvKdY.png","https://s2.loli.net/2023/03/06/dlmYNnARZaxJ5MH.png","https://s2.loli.net/2023/03/06/7zvewSLhFmbc8G1.png","https://s2.loli.net/2023/03/06/G7qQoEy8DCX9bLJ.png","https://s2.loli.net/2023/03/06/qoNhgzM2PXpZU9B.png","https://s2.loli.net/2023/03/06/9LnaoUxHzlY1GdV.png"],"dateModified":null,"author":[{"@type":"Person","name":"Cotton Eye Joe","url":"https://github.com/ToDreamr"}]}</script><title>SpringCloud 2</title><meta name="description" content="image-20230306230950443image-20230306230950443 å¾®æœåŠ¡è¿›é˜¶ å‰é¢æˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºNetflixçš„è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Šæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œæ¥çœ‹çœ‹ç›®å‰æˆ‘ä»¬æ‰€è®¤è¯†åˆ°çš„SpringCloudå„å¤§ç»„ä»¶çš„ç»´æŠ¤æƒ…å†µï¼š æ³¨å†Œä¸­å¿ƒï¼š Eurekaï¼ˆå±äºNetflixï¼Œ2.xç‰ˆæœ¬ä¸å†å¼€æº...">
    <link rel="preload" href="/assets/style-CwmJ3HJv.css" as="style"><link rel="stylesheet" href="/assets/style-CwmJ3HJv.css">
    <link rel="modulepreload" href="/assets/app-7V2lPg4G.js"><link rel="modulepreload" href="/assets/SpringCloud 2.html-BvRB1gJE.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/portfolio.html-CAvE7Z9N.js" as="script"><link rel="prefetch" href="/assets/index.html-C9wldKJC.js" as="script"><link rel="prefetch" href="/assets/å‹é“¾.html-BtOxmXT-.js" as="script"><link rel="prefetch" href="/assets/disable.html-B__KZUnk.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-BksT1Hmf.js" as="script"><link rel="prefetch" href="/assets/layout.html-C2JBLIlc.js" as="script"><link rel="prefetch" href="/assets/markdown.html-DXn6p_Tg.js" as="script"><link rel="prefetch" href="/assets/page.html-5BMOZX8K.js" as="script"><link rel="prefetch" href="/assets/index.html-DhCYxvEF.js" as="script"><link rel="prefetch" href="/assets/å‹é“¾.html--AwLydcX.js" as="script"><link rel="prefetch" href="/assets/index.html-DLtktf7J.js" as="script"><link rel="prefetch" href="/assets/index.html-BztLX3l1.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-Db7gYFeM.js" as="script"><link rel="prefetch" href="/assets/Redis.html-C6sbVZr4.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-SHG5Fum7.js" as="script"><link rel="prefetch" href="/assets/é«˜å¹¶å‘ç¼–ç¨‹.html-CW1WC9iw.js" as="script"><link rel="prefetch" href="/assets/JVMå†…å­˜æ¨¡å‹.html-D_SBzb_i.js" as="script"><link rel="prefetch" href="/assets/å†…å­˜ç®¡ç†.html-Cb34YNfV.js" as="script"><link rel="prefetch" href="/assets/ç±»ä¸ç±»åŠ è½½.html-zYUf0gpo.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™.html-DcdNvEra.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰ç»“æ„å‹.html-mAPfUaId.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰åˆ›å»ºå‹.html-CQTTl6Nf.js" as="script"><link rel="prefetch" href="/assets/è®¾è®¡æ¨¡å¼ç³»åˆ— - è®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰è¡Œä¸ºå‹.html-DOlE4_k4.js" as="script"><link rel="prefetch" href="/assets/Cpp.html-jEQKCv3-.js" as="script"><link rel="prefetch" href="/assets/baz.html-BN_jYEfm.js" as="script"><link rel="prefetch" href="/assets/index.html-CnP8NN36.js" as="script"><link rel="prefetch" href="/assets/ray.html-C0ceSN9U.js" as="script"><link rel="prefetch" href="/assets/index.html-BZ1xjawG.js" as="script"><link rel="prefetch" href="/assets/index.html-D5pd6CAI.js" as="script"><link rel="prefetch" href="/assets/index.html-AazjbObK.js" as="script"><link rel="prefetch" href="/assets/å¹¶å‘ç¼–ç¨‹.html-SO2oxBj-.js" as="script"><link rel="prefetch" href="/assets/SpringCloud 1.html-d1C3Jruj.js" as="script"><link rel="prefetch" href="/assets/SpringCloud 3.html-DxhD-94A.js" as="script"><link rel="prefetch" href="/assets/index.html-phl5fAXb.js" as="script"><link rel="prefetch" href="/assets/æ•°ä¹‹å’Œ.html-C4cNb-Gd.js" as="script"><link rel="prefetch" href="/assets/æœ‰åºæ•°ç»„çš„å¹³æ–¹.html-DvRsWalr.js" as="script"><link rel="prefetch" href="/assets/ç§»é™¤å…ƒç´ .html-DKIYZU8A.js" as="script"><link rel="prefetch" href="/assets/èºæ—‹çŸ©é˜µ.html-CYz1Q5OM.js" as="script"><link rel="prefetch" href="/assets/é“¾è¡¨ç¯‡.html-QLShRSs_.js" as="script"><link rel="prefetch" href="/assets/é•¿åº¦æœ€å°çš„æ•°ç»„.html-CCUqadjp.js" as="script"><link rel="prefetch" href="/assets/index.html-OhOyJNfn.js" as="script"><link rel="prefetch" href="/assets/äºŒåˆ†æ³•.html-DJoPxb-t.js" as="script"><link rel="prefetch" href="/assets/å“ˆå¸Œç¯‡.html-CUE9cZRu.js" as="script"><link rel="prefetch" href="/assets/é“¾è¡¨.html-DJK1HdEA.js" as="script"><link rel="prefetch" href="/assets/Docker.html-CzYxJ7bb.js" as="script"><link rel="prefetch" href="/assets/æ•°æ®ç»“æ„å›¾ç¤º.html-CUm7uHgd.js" as="script"><link rel="prefetch" href="/assets/å®ä¾‹åŒ–Node.html-D-gcaA8r.js" as="script"><link rel="prefetch" href="/assets/å¯¹è±¡é—´çš„å…³ç³».html-BYO5OdJJ.js" as="script"><link rel="prefetch" href="/assets/ThreadLocal.html-CR-NpOMl.js" as="script"><link rel="prefetch" href="/assets/å…³é”®å­—.html-CGfJEXeQ.js" as="script"><link rel="prefetch" href="/assets/404.html-GyCG4bbD.js" as="script"><link rel="prefetch" href="/assets/index.html-mNkO6SpZ.js" as="script"><link rel="prefetch" href="/assets/index.html--CLwPFXX.js" as="script"><link rel="prefetch" href="/assets/index.html-C-pptsQn.js" as="script"><link rel="prefetch" href="/assets/index.html-CgDhLFdr.js" as="script"><link rel="prefetch" href="/assets/index.html-DoOe8tuC.js" as="script"><link rel="prefetch" href="/assets/index.html-BSkFXUO7.js" as="script"><link rel="prefetch" href="/assets/index.html-A1l5oNsi.js" as="script"><link rel="prefetch" href="/assets/index.html-hTYQ5qrF.js" as="script"><link rel="prefetch" href="/assets/index.html-zUFVq1cP.js" as="script"><link rel="prefetch" href="/assets/index.html-diK-wnsX.js" as="script"><link rel="prefetch" href="/assets/index.html-CXn_7__T.js" as="script"><link rel="prefetch" href="/assets/index.html-B2BFkybs.js" as="script"><link rel="prefetch" href="/assets/index.html-XJuxdRDh.js" as="script"><link rel="prefetch" href="/assets/index.html-BTcirJ2i.js" as="script"><link rel="prefetch" href="/assets/index.html-Dqe6ocXM.js" as="script"><link rel="prefetch" href="/assets/index.html-C8Sln--0.js" as="script"><link rel="prefetch" href="/assets/index.html-2h6M3VoU.js" as="script"><link rel="prefetch" href="/assets/index.html-CbnKe6x_.js" as="script"><link rel="prefetch" href="/assets/index.html-DlqPTk40.js" as="script"><link rel="prefetch" href="/assets/index.html-KjbSCFlf.js" as="script"><link rel="prefetch" href="/assets/index.html-DBosTiSB.js" as="script"><link rel="prefetch" href="/assets/index.html-n4RJ64PH.js" as="script"><link rel="prefetch" href="/assets/index.html-c9vOdeGb.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/ç§’é€Ÿï¼•ã‚»ãƒ³ãƒãƒ¡ãƒ¼ãƒˆãƒ«.svg" alt><!----><!----></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="é›¨å±±"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user-graduate" style=""></span><!--]-->é›¨å±±<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/portfolio.html" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/demo/" aria-label="æ–‡æ¡£å’Œç¬”è®°"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->æ–‡æ¡£å’Œç¬”è®°<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/%E5%8F%8B%E9%93%BE.html" aria-label="æœ‹å‹ä»¬"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-user-graduate" style=""></span><!--]-->æœ‹å‹ä»¬<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><span class="vp-sidebar-title">åç«¯ç†è®º</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">åˆ†å¸ƒå¼</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">å¾®æœåŠ¡æ¼”è¿›</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Cloud</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/doc/%E5%88%86%E5%B8%83%E5%BC%8F/cloud/SpringCloud%201.html" aria-label="SpringCloud 1"><!---->SpringCloud 1<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/doc/%E5%88%86%E5%B8%83%E5%BC%8F/cloud/SpringCloud%202.html" aria-label="SpringCloud 2"><!---->SpringCloud 2<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/doc/%E5%88%86%E5%B8%83%E5%BC%8F/cloud/SpringCloud%203.html" aria-label="SpringCloud 3"><!---->SpringCloud 3<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">è®¾è®¡æ¨¡å¼</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">æ•°æ®åº“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">ç®—æ³•</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">çº¿ç¨‹æ± </span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">æ¶ˆæ¯é˜Ÿåˆ—</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">è™šæ‹Ÿæœº</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">è¯­è¨€åŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">è¿ç»´éƒ¨ç½²</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">IO</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">æŒ‡å¼•</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-check-square" style=""></span><span class="vp-sidebar-title">å¸®åŠ©</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="auto-link external-link vp-sidebar-link" href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" aria-label="å¹»ç¯ç‰‡" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span><!--]-->å¹»ç¯ç‰‡<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->SpringCloud 2</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/ToDreamr" target="_blank" rel="noopener noreferrer">Cotton Eye Joe</a></span><span property="author" content="Cotton Eye Joe"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 62 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT62M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#nacos-æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ">Nacos æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®‰è£…ä¸éƒ¨ç½²">å®‰è£…ä¸éƒ¨ç½²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æœåŠ¡æ³¨å†Œä¸å‘ç°">æœåŠ¡æ³¨å†Œä¸å‘ç°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é›†ç¾¤åˆ†åŒº">é›†ç¾¤åˆ†åŒº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é…ç½®ä¸­å¿ƒ">é…ç½®ä¸­å¿ƒ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‘½åç©ºé—´">å‘½åç©ºé—´</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ç°é«˜å¯ç”¨">å®ç°é«˜å¯ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#sentinel-æµé‡é˜²å«å…µ">Sentinel æµé‡é˜²å«å…µ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®‰è£…ä¸éƒ¨ç½²-1">å®‰è£…ä¸éƒ¨ç½²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµé‡æ§åˆ¶">æµé‡æ§åˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é™æµå’Œå¼‚å¸¸å¤„ç†">é™æµå’Œå¼‚å¸¸å¤„ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#çƒ­ç‚¹å‚æ•°é™æµ">çƒ­ç‚¹å‚æ•°é™æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æœåŠ¡ç†”æ–­å’Œé™çº§">æœåŠ¡ç†”æ–­å’Œé™çº§</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#seataä¸åˆ†å¸ƒå¼äº‹åŠ¡">Seataä¸åˆ†å¸ƒå¼äº‹åŠ¡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é¡¹ç›®ç¯å¢ƒæ­å»º">é¡¹ç›®ç¯å¢ƒæ­å»º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ">åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#seataæœºåˆ¶ç®€ä»‹">Seataæœºåˆ¶ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²">ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²">ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><figure><img src="https://s2.loli.net/2023/03/06/V1dFqQMR7T2GzSJ.png" alt="image-20230306230950443" tabindex="0" loading="lazy"><figcaption>image-20230306230950443</figcaption></figure><h1 id="å¾®æœåŠ¡è¿›é˜¶" tabindex="-1"><a class="header-anchor" href="#å¾®æœåŠ¡è¿›é˜¶"><span>å¾®æœåŠ¡è¿›é˜¶</span></a></h1><p>å‰é¢æˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºNetflixçš„è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Šæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œæ¥çœ‹çœ‹ç›®å‰æˆ‘ä»¬æ‰€è®¤è¯†åˆ°çš„SpringCloudå„å¤§ç»„ä»¶çš„ç»´æŠ¤æƒ…å†µï¼š</p><ul><li><strong>æ³¨å†Œä¸­å¿ƒï¼š</strong> Eurekaï¼ˆå±äº<em>Netflix</em>ï¼Œ2.xç‰ˆæœ¬ä¸å†å¼€æºï¼Œ1.xç‰ˆæœ¬ä»åœ¨æ›´æ–°ï¼‰</li><li><strong>æœåŠ¡è°ƒç”¨ï¼š</strong> Ribbonï¼ˆå±äº<em>Netflix</em>ï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€SpringCloud Loadbalancerï¼ˆå±äº<em>SpringCloud</em>å®˜æ–¹ï¼Œç›®å‰çš„é»˜è®¤æ–¹æ¡ˆï¼‰</li><li><strong>æœåŠ¡é™çº§ï¼š</strong> Hystrixï¼ˆå±äº<em>Netflix</em>ï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰</li><li><strong>è·¯ç”±ç½‘å…³ï¼š</strong> Zuulï¼ˆå±äº<em>Netflix</em>ï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€Gatewayï¼ˆå±äº<em>SpringCloud</em>å®˜æ–¹ï¼Œæ¨èæ–¹æ¡ˆï¼‰</li><li><strong>é…ç½®ä¸­å¿ƒï¼š</strong> Configï¼ˆå±äº<em>SpringCloud</em>å®˜æ–¹ï¼‰</li></ul><p>å¯è§ï¼Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ•´å¥—è§£å†³æ–¹æ¡ˆä¸­ï¼Œè¶…è¿‡åŠæ•°çš„ç»„ä»¶éƒ½å·²ç»å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå¹¶ä¸”éƒ¨åˆ†ç»„ä»¶éƒ½æ˜¯SpringCloudå®˜æ–¹å‡ºæ‰‹æä¾›æ¡†æ¶è¿›è¡Œè§£å†³ï¼Œå› æ­¤ï¼Œå¯»æ‰¾ä¸€å¥—æ›´å¥½çš„è§£å†³æ–¹æ¡ˆåŠ¿åœ¨å¿…è¡Œï¼Œä¹Ÿå°±å¼•å‡ºäº†æˆ‘ä»¬æœ¬ç« çš„ä¸»è§’ï¼š<strong>SpringCloud Alibaba</strong></p><p>é˜¿é‡Œå·´å·´ä½œä¸ºä¸šç•Œçš„äº’è”ç½‘å¤§å‚ï¼Œç»™å‡ºäº†ä¸€å¥—å…¨æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå®˜æ–¹ç½‘ç«™ï¼ˆä¸­æ–‡ï¼‰ï¼šhttps://spring-cloud-alibaba-group.github.io/github-pages/2021/zh-cn/index.html</p><blockquote><p>Spring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚æ­¤é¡¹ç›®åŒ…å«å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡çš„å¿…éœ€ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘è€…é€šè¿‡ Spring Cloud ç¼–ç¨‹æ¨¡å‹è½»æ¾ä½¿ç”¨è¿™äº›ç»„ä»¶æ¥å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡ã€‚</p><p>ä¾æ‰˜ Spring Cloud Alibabaï¼Œæ‚¨åªéœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£å’Œå°‘é‡é…ç½®ï¼Œå°±å¯ä»¥å°† Spring Cloud åº”ç”¨æ¥å…¥é˜¿é‡Œåˆ†å¸ƒå¼åº”ç”¨è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡é˜¿é‡Œä¸­é—´ä»¶æ¥è¿…é€Ÿæ­å»ºåˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿã€‚</p></blockquote><p>ç›®å‰ Spring Cloud Alibaba æä¾›äº†å¦‚ä¸‹åŠŸèƒ½:</p><ol><li><strong>æœåŠ¡é™æµé™çº§</strong>ï¼šæ”¯æŒ WebServletã€WebFlux, OpenFeignã€RestTemplateã€Dubbo é™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§ Metrics ç›‘æ§ã€‚</li><li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç°</strong>ï¼šé€‚é… Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº† Ribbon çš„æ”¯æŒã€‚</li><li><strong>åˆ†å¸ƒå¼é…ç½®ç®¡ç†</strong>ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚</li><li><strong>RpcæœåŠ¡</strong>ï¼šæ‰©å±• Spring Cloud å®¢æˆ·ç«¯ RestTemplate å’Œ OpenFeignï¼Œæ”¯æŒè°ƒç”¨ Dubbo RPC æœåŠ¡</li><li><strong>æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›</strong>ï¼šåŸºäº Spring Cloud Stream ä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚</li><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼šä½¿ç”¨ @GlobalTransactional æ³¨è§£ï¼Œ é«˜æ•ˆå¹¶ä¸”å¯¹ä¸šåŠ¡é›¶ä¾µå…¥åœ°è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</li><li><strong>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨</strong>ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li><li><strong>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</strong>ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰ Workerï¼ˆschedulerx-clientï¼‰ä¸Šæ‰§è¡Œã€‚</li><li><strong>é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡</strong>ï¼šè¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼ŒSpringCloudAlibabaå®é™…ä¸Šæ˜¯å¯¹æˆ‘ä»¬çš„SpringCloudç»„ä»¶å¢å¼ºåŠŸèƒ½ï¼Œæ˜¯SpringCloudçš„å¢å¼ºæ¡†æ¶ï¼Œå¯ä»¥å…¼å®¹SpringCloudåŸç”Ÿç»„ä»¶å’ŒSpringCloudAlibabaçš„ç»„ä»¶ã€‚</p><p>å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼ŒæŠŠæˆ‘ä»¬ä¹‹å‰æ‰“åŒ…å¥½çš„æ‹†åˆ†é¡¹ç›®è§£å‹ï¼Œæˆ‘ä»¬å°†åŸºäºå®ƒè¿›è¡Œè®²è§£ã€‚</p><hr><figure><img src="https://s2.loli.net/2023/03/06/pQkSrLx9NZRn8Ub.png" alt="image-20230306230942876" tabindex="0" loading="lazy"><figcaption>image-20230306230942876</figcaption></figure><h2 id="nacos-æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#nacos-æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ"><span>Nacos æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ</span></a></h2><p>Nacosï¼ˆ<strong>Na</strong>ming <strong>Co</strong>nfiguration <strong>S</strong>erviceï¼‰æ˜¯ä¸€æ¬¾é˜¿é‡Œå·´å·´å¼€æºçš„æœåŠ¡æ³¨å†Œä¸å‘ç°ã€é…ç½®ç®¡ç†çš„ç»„ä»¶ï¼Œç›¸å½“äºæ˜¯Eureka+Configçš„ç»„åˆå½¢æ€ã€‚</p><h3 id="å®‰è£…ä¸éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#å®‰è£…ä¸éƒ¨ç½²"><span>å®‰è£…ä¸éƒ¨ç½²</span></a></h3><p>NacosæœåŠ¡å™¨æ˜¯ç‹¬ç«‹å®‰è£…éƒ¨ç½²çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸‹è½½æœ€æ–°çš„NacosæœåŠ¡ç«¯ç¨‹åºï¼Œä¸‹è½½åœ°å€ï¼šhttps://github.com/alibaba/nacosï¼Œè¿ä¸ä¸Šå¯ä»¥åˆ°è§†é¢‘ä¸‹æ–¹äº‘ç›˜ä¸­ä¸‹è½½ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/VStPIABaXxMp2N9.png" alt="image-20230306231045825" tabindex="0" loading="lazy"><figcaption>image-20230306231045825</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯<code>1.4.3</code>ç‰ˆæœ¬ï¼ˆ2022å¹´2æœˆ27æ—¥å‘å¸ƒçš„ï¼‰ï¼Œæˆ‘ä»¬ç›´æ¥ä¸‹è½½<code>zip</code>æ–‡ä»¶å³å¯ã€‚</p><p>æ¥ç€æˆ‘ä»¬å°†æ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œå¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/wWbuXRGizrQCT8J.png" alt="image-20230306231054919" tabindex="0" loading="lazy"><figcaption>image-20230306231054919</figcaption></figure><p>æˆ‘ä»¬ç›´æ¥å°†å…¶æ‹–å…¥åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ï¼Œä¾¿äºæˆ‘ä»¬ä¸€ä¼šåœ¨IDEAå†…éƒ¨å¯åŠ¨ï¼Œæ¥ç€æ·»åŠ è¿è¡Œé…ç½®ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/bM8doEZPth7DHfe.png" alt="image-20230306231104823" tabindex="0" loading="lazy"><figcaption>image-20230306231104823</figcaption></figure><p>å…¶ä¸­<code>-m standalone</code>è¡¨ç¤ºå•èŠ‚ç‚¹æ¨¡å¼ï¼ŒMacå’ŒLinuxä¸‹è®°å¾—å°†è§£é‡Šå™¨è®¾å®šä¸º<code>/bin/bash</code>ï¼Œç”±äºNacosåœ¨Mac/Linuxé»˜è®¤æ˜¯åå°å¯åŠ¨æ¨¡å¼ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹å®ƒçš„bashæ–‡ä»¶ï¼Œè®©å®ƒå˜æˆå‰å°å¯åŠ¨ï¼Œè¿™æ ·IDEAå…³é—­äº†Nacoså°±è‡ªåŠ¨å…³é—­äº†ï¼Œå¦åˆ™å¼€å‘ç¯å¢ƒä¸‹å¾ˆå®¹æ˜“å¿˜è®°å…³ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># æ³¨é‡Šæ‰ nohup $JAVA ${JAVA_OPT} nacos.nacos &gt;&gt; ${BASE_DIR}/logs/start.out 2&gt;&amp;1 &amp;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># æ›¿æ¢æˆä¸‹é¢çš„</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$JAVA</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> ${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">JAVA_OPT</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> nacos.nacos</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æˆ‘ä»¬ç‚¹å‡»å¯åŠ¨ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/O3pMSvDbxPKYT5q.png" alt="image-20230306231113946" tabindex="0" loading="lazy"><figcaption>image-20230306231113946</figcaption></figure><p>OKï¼Œå¯åŠ¨æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„ç®¡ç†é¡µé¢åœ°å€ä¹Ÿæ˜¯ç»™æˆ‘ä»¬è´´å‡ºæ¥äº†ï¼š http://localhost:8848/nacos/index.htmlï¼Œè®¿é—®è¿™ä¸ªåœ°å€ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/sbKTUqhLViIfrmR.png" alt="image-20230306231125828" tabindex="0" loading="lazy"><figcaption>image-20230306231125828</figcaption></figure><p>é»˜è®¤çš„ç”¨æˆ·åå’Œç®¡ç†å‘˜å¯†ç éƒ½æ˜¯<code>nacos</code>ï¼Œç›´æ¥ç™»é™†å³å¯ï¼Œå¯ä»¥çœ‹åˆ°è¿›å…¥ç®¡ç†é¡µé¢ä¹‹ååŠŸèƒ½ä¹Ÿæ˜¯ç›¸å½“ä¸°å¯Œï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/dom3WpJsiajgCE7.png" alt="image-20230306231150574" tabindex="0" loading="lazy"><figcaption>image-20230306231150574</figcaption></figure><p>è‡³æ­¤ï¼ŒNacosçš„å®‰è£…ä¸éƒ¨ç½²å®Œæˆã€‚</p><h3 id="æœåŠ¡æ³¨å†Œä¸å‘ç°" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡æ³¨å†Œä¸å‘ç°"><span>æœåŠ¡æ³¨å†Œä¸å‘ç°</span></a></h3><p>ç°åœ¨æˆ‘ä»¬è¦å®ç°åŸºäºNacosçš„æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¼å…¥SpringCloudAlibabaç›¸å…³çš„ä¾èµ–ï¼Œæˆ‘ä»¬åœ¨çˆ¶å·¥ç¨‹å°†ä¾èµ–è¿›è¡Œç®¡ç†ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependencyManagement</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.mybatis.spring.boot&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;mybatis-spring-boot-starter&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;2.2.0&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      	&lt;!-- è¿™é‡Œå¼•å…¥æœ€æ–°çš„SpringCloudä¾èµ– --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-dependencies&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;2021.0.1&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          	&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;pom&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;import&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     	  &lt;!-- è¿™é‡Œå¼•å…¥æœ€æ–°çš„SpringCloudAlibabaä¾èµ–ï¼Œ2021.0.1.0ç‰ˆæœ¬æ”¯æŒSpringBoot2.6.X --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-alibaba-dependencies&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;2021.0.1.0&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;pom&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;import&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependencyManagement</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨å­é¡¹ç›®ä¸­æ·»åŠ æœåŠ¡å‘ç°ä¾èµ–äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ä»¥å›¾ä¹¦æœåŠ¡ä¸ºä¾‹ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å’Œæ³¨å†Œåˆ°Eurekaä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®Nacosæ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	# ä¹‹åæ‰€æœ‰çš„å›¾ä¹¦æœåŠ¡èŠ‚ç‚¹å°±81XXç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8101</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  datasource</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    driver-class-name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">com.mysql.cj.jdbc.Driver</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">jdbc:mysql://cloudstudy.mysql.cn-chengdu.rds.aliyuncs.com:3306/cloudstudy</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">test</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123456</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # åº”ç”¨åç§° bookservice</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">bookservice</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      discovery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # é…ç½®Nacosæ³¨å†Œä¸­å¿ƒåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8848</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€å¯åŠ¨æˆ‘ä»¬çš„å›¾ä¹¦æœåŠ¡ï¼Œå¯ä»¥åœ¨Nacosçš„æœåŠ¡åˆ—è¡¨ä¸­æ‰¾åˆ°ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/9PLBGOXoaERnUwM.png" alt="image-20230306231202683" tabindex="0" loading="lazy"><figcaption>image-20230306231202683</figcaption></figure><p>æŒ‰ç…§åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€å°†å¦å¤–ä¸¤ä¸ªæœåŠ¡ä¹Ÿæ³¨å†Œåˆ°Nacosä¸­ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/K6VBtqEWSLnMp21.png" alt="image-20230306231211930" tabindex="0" loading="lazy"><figcaption>image-20230306231211930</figcaption></figure><p>æ¥ç€æˆ‘ä»¬ä½¿ç”¨OpenFeignï¼Œå®ç°æœåŠ¡å‘ç°è¿œç¨‹è°ƒç”¨ä»¥åŠè´Ÿè½½å‡è¡¡ï¼Œå¯¼å…¥ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-openfeign&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!-- è¿™é‡Œéœ€è¦å•ç‹¬å¯¼å…¥LoadBalancerä¾èµ– --&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-loadbalancer&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–å†™æ¥å£ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">FeignClient</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;userservice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">FeignClient</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bookservice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/book/{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Book</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Service</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BorrowServiceImpl</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BorrowService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BorrowMapper</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    UserClient</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BookClient</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserBorrowDetailByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Borrow</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">borrow</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBorrowsByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Book</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bookList</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> borrow</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">stream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(b </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">collect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Collectors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserBorrowDetail</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(user, bookList);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">EnableFeignClients</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SpringBootApplication</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BorrowApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        SpringApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">BorrowApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, args);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/HIGvXAad1EOVPt6.png" alt="image-20230306231226300" tabindex="0" loading="lazy"><figcaption>image-20230306231226300</figcaption></figure><p>æµ‹è¯•æ­£å¸¸ï¼Œå¯ä»¥è‡ªåŠ¨å‘ç°æœåŠ¡ï¼Œæ¥ç€æˆ‘ä»¬æ¥å¤šé…ç½®å‡ ä¸ªå®ä¾‹ï¼Œå»æ‰å›¾ä¹¦æœåŠ¡å’Œç”¨æˆ·æœåŠ¡çš„ç«¯å£é…ç½®ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/WZGdJ5BYpmbMuNT.png" alt="image-20230306231234119" tabindex="0" loading="lazy"><figcaption>image-20230306231234119</figcaption></figure><p>ç„¶åæˆ‘ä»¬åœ¨å›¾ä¹¦æœåŠ¡å’Œç”¨æˆ·æœåŠ¡ä¸­æ·»åŠ ä¸€å¥æ‰“å°æ–¹ä¾¿ä¹‹åæŸ¥çœ‹ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> uid){</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è°ƒç”¨ç”¨æˆ·æœåŠ¡&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨å°†å…¨éƒ¨æœåŠ¡å¯åŠ¨ï¼š <img src="https://s2.loli.net/2023/03/06/GCrm8wgWXLzYhtK.png" alt="image-20230306231244149" loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°Nacosä¸­çš„å®ä¾‹æ•°é‡å·²ç»æ˜¾ç¤ºä¸º<code>2</code>ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/p6iYrPa8e1btZkl.png" alt="image-20230306231251732" tabindex="0" loading="lazy"><figcaption>image-20230306231251732</figcaption></figure><p>æ¥ç€æˆ‘ä»¬è°ƒç”¨å€Ÿé˜…æœåŠ¡ï¼Œçœ‹çœ‹èƒ½å¦è´Ÿè½½å‡è¡¡è¿œç¨‹è°ƒç”¨ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/jCl8RGhaIiUDBgm.png" alt="image-20230306231259820" tabindex="0" loading="lazy"><figcaption>image-20230306231259820</figcaption></figure><figure><img src="https://s2.loli.net/2023/03/06/2bWdfmnVOyGzlZr.png" alt="image-20230306231306653" tabindex="0" loading="lazy"><figcaption>image-20230306231306653</figcaption></figure><p>OKï¼Œè´Ÿè½½å‡è¡¡è¿œç¨‹è°ƒç”¨æ²¡æœ‰é—®é¢˜ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®ç°äº†åŸºäºNacosçš„æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼Œå®é™…ä¸Šå¤§è‡´æµç¨‹ä¸Eurekaä¸€è‡´ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒNacosåŒºåˆ†äº†ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/cF5MoVX6vNnzx9j.png" alt="image-20230306231317971" tabindex="0" loading="lazy"><figcaption>image-20230306231317971</figcaption></figure><p>é‚£ä¹ˆä¸´æ—¶å’Œéä¸´æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><ul><li>ä¸´æ—¶å®ä¾‹ï¼šå’ŒEurekaä¸€æ ·ï¼Œé‡‡ç”¨å¿ƒè·³æœºåˆ¶å‘Nacoså‘é€è¯·æ±‚ä¿æŒåœ¨çº¿çŠ¶æ€ï¼Œä¸€æ—¦å¿ƒè·³åœæ­¢ï¼Œä»£è¡¨å®ä¾‹ä¸‹çº¿ï¼Œä¸ä¿ç•™å®ä¾‹ä¿¡æ¯ã€‚</li><li>éä¸´æ—¶å®ä¾‹ï¼šç”±Nacosä¸»åŠ¨è¿›è¡Œè”ç³»ï¼Œå¦‚æœè¿æ¥å¤±è´¥ï¼Œé‚£ä¹ˆä¸ä¼šç§»é™¤å®ä¾‹ä¿¡æ¯ï¼Œè€Œæ˜¯å°†å¥åº·çŠ¶æ€è®¾å®šä¸ºfalseï¼Œç›¸å½“äºä¼šå¯¹æŸä¸ªå®ä¾‹çŠ¶æ€æŒç»­åœ°è¿›è¡Œç›‘æ§ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ä¸´æ—¶å®ä¾‹ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">borrowservice</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      discovery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8848</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # å°†ephemeralä¿®æ”¹ä¸ºfalseï¼Œè¡¨ç¤ºéä¸´æ—¶å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        ephemeral</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æˆ‘ä»¬åœ¨Nacosä¸­æŸ¥çœ‹ï¼Œå¯ä»¥å‘ç°å®ä¾‹å·²ç»ä¸æ˜¯ä¸´æ—¶çš„äº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/FdRTjlKszDoOPU3.png" alt="image-20230306231328378" tabindex="0" loading="lazy"><figcaption>image-20230306231328378</figcaption></figure><p>å¦‚æœè¿™æ—¶æˆ‘ä»¬å…³é—­æ­¤å®ä¾‹ï¼Œé‚£ä¹ˆä¼šå˜æˆè¿™æ ·ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/R5Jyhl29UcvuOCb.png" alt="image-20230306231337931" tabindex="0" loading="lazy"><figcaption>image-20230306231337931</figcaption></figure><p>åªæ˜¯å°†å¥åº·çŠ¶æ€å˜ä¸ºfalseï¼Œè€Œä¸ä¼šåˆ é™¤å®ä¾‹çš„ä¿¡æ¯ã€‚</p><h3 id="é›†ç¾¤åˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#é›†ç¾¤åˆ†åŒº"><span>é›†ç¾¤åˆ†åŒº</span></a></h3><p>å®é™…ä¸Šé›†ç¾¤åˆ†åŒºæ¦‚å¿µåœ¨ä¹‹å‰çš„Eurekaä¸­ä¹Ÿæœ‰å‡ºç°ï¼Œæ¯”å¦‚ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">eureka</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  client</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">		fetch-registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    register-with-eureka</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    service-url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      defaultZone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">http://localhost:8888/eureka</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      # è¿™ä¸ªdefaultZoneæ˜¯ä¸ªå•¥ç©æ„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªåç§°ï¼Ÿä¸ºä»€ä¹ˆè¦è¦ç”¨è¿™æ ·çš„å½¢å¼æ¥å£°æ˜æ³¨å†Œä¸­å¿ƒï¼Ÿ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨ä¸­ï¼Œç›¸åŒæœåŠ¡çš„å®ä¾‹å¯èƒ½ä¼šåœ¨ä¸åŒçš„æœºå™¨ã€ä½ç½®ä¸Šå¯åŠ¨ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ç”¨æˆ·ç®¡ç†æœåŠ¡ï¼Œå¯èƒ½åœ¨æˆéƒ½æœ‰1å°æœåŠ¡å™¨éƒ¨ç½²ã€é‡åº†æœ‰ä¸€å°æœåŠ¡å™¨éƒ¨ç½²ï¼Œè€Œè¿™æ—¶ï¼Œæˆ‘ä»¬åœ¨æˆéƒ½çš„æœåŠ¡å™¨ä¸Šå¯åŠ¨äº†å€Ÿé˜…æœåŠ¡ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„å€Ÿé˜…æœåŠ¡ç°åœ¨è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼Œå°±åº”è¯¥ä¼˜å…ˆé€‰æ‹©åŒä¸€ä¸ªåŒºåŸŸçš„ç”¨æˆ·æœåŠ¡è¿›è¡Œè°ƒç”¨ï¼Œè¿™æ ·ä¼šä½¿å¾—å“åº”é€Ÿåº¦æ›´å¿«ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/szyGRrEfZ1KWmpj.png" alt="image-20230306231411711" tabindex="0" loading="lazy"><figcaption>image-20230306231411711</figcaption></figure><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹éƒ¨ç½²åœ¨ä¸åŒæœºæˆ¿çš„æœåŠ¡è¿›è¡Œåˆ†åŒºï¼Œå¯ä»¥çœ‹åˆ°å®ä¾‹çš„åˆ†åŒºæ˜¯é»˜è®¤ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/wlO9dQ1NtKCxFTi.png" alt="image-20230306231402008" tabindex="0" loading="lazy"><figcaption>image-20230306231402008</figcaption></figure><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">borrowservice</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      discovery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8848</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # ä¿®æ”¹ä¸ºé‡åº†åœ°åŒºçš„é›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        cluster-name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Chongqing</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ç„¶ç”±äºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸åŒçš„å¯åŠ¨é…ç½®ï¼Œç›´æ¥åœ¨å¯åŠ¨é…ç½®ä¸­æ·»åŠ ç¯å¢ƒå˜é‡<code>spring.cloud.nacos.discovery.cluster-name</code>ä¹Ÿè¡Œï¼Œè¿™é‡Œæˆ‘ä»¬å°†ç”¨æˆ·æœåŠ¡å’Œå›¾ä¹¦æœåŠ¡ä¸¤ä¸ªåŒºåŸŸéƒ½åˆ†é…ä¸€ä¸ªï¼Œå€Ÿé˜…æœåŠ¡å°±é…ç½®ä¸ºæˆéƒ½åœ°åŒºï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/cwIhdCMmATELvlN.png" alt="image-20230306231435388" tabindex="0" loading="lazy"><figcaption>image-20230306231435388</figcaption></figure><p>ä¿®æ”¹å®Œæˆä¹‹åï¼Œæˆ‘ä»¬æ¥å°è¯•é‡æ–°å¯åŠ¨ä¸€ä¸‹ï¼ˆNacosä¹Ÿè¦é‡å¯ï¼‰ï¼Œè§‚å¯ŸNacosä¸­é›†ç¾¤åˆ†å¸ƒæƒ…å†µï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/jrYo3epaLMyQnu4.png" alt="image-20230306231443247" tabindex="0" loading="lazy"><figcaption>image-20230306231443247</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ç°åœ¨æœ‰ä¸¤ä¸ªé›†ç¾¤ï¼Œå¹¶ä¸”éƒ½æœ‰ä¸€ä¸ªå®ä¾‹æ­£åœ¨è¿è¡Œã€‚æˆ‘ä»¬æ¥ç€å»è°ƒç”¨å€Ÿé˜…æœåŠ¡ï¼Œä½†æ˜¯å‘ç°å¹¶æ²¡æœ‰æŒ‰ç…§åŒºåŸŸè¿›è¡Œä¼˜å…ˆè°ƒç”¨ï¼Œè€Œä¾ç„¶ä½¿ç”¨çš„æ˜¯è½®è¯¢æ¨¡å¼çš„è´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚</p><p>æˆ‘ä»¬å¿…é¡»è¦æä¾›Nacosçš„è´Ÿè½½å‡è¡¡å®ç°æ‰èƒ½å¼€å¯åŒºåŸŸä¼˜å…ˆè°ƒç”¨æœºåˆ¶ï¼Œåªéœ€è¦åœ¨é…åˆ¶æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹å³å¯ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">borrowservice</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      discovery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8848</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        cluster-name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Chengdu</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # å°†loadbalancerçš„nacosæ”¯æŒå¼€å¯ï¼Œé›†æˆNacosè´Ÿè½½å‡è¡¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    loadbalancer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æˆ‘ä»¬é‡å¯å€Ÿé˜…æœåŠ¡ï¼Œä¼šå‘ç°ä¼˜å…ˆè°ƒç”¨çš„æ˜¯åŒåŒºåŸŸçš„ç”¨æˆ·å’Œå›¾ä¹¦æœåŠ¡ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å°†æˆéƒ½åœ°åŒºçš„æœåŠ¡ä¸‹çº¿ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/s1ko9UcD4mMQ5fW.png" alt="image-20230306231453470" tabindex="0" loading="lazy"><figcaption>image-20230306231453470</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸‹çº¿ä¹‹åï¼Œç”±äºæœ¬åŒºåŸŸå†…æ²¡æœ‰å¯ç”¨æœåŠ¡äº†ï¼Œå€Ÿé˜…æœåŠ¡å°†ä¼šè°ƒç”¨é‡åº†åŒºåŸŸçš„ç”¨æˆ·æœåŠ¡ã€‚</p><p>é™¤äº†æ ¹æ®åŒºåŸŸä¼˜å…ˆè°ƒç”¨ä¹‹å¤–ï¼ŒåŒä¸€ä¸ªåŒºåŸŸå†…çš„å®ä¾‹ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®æƒé‡ï¼ŒNacosä¼šä¼˜å…ˆé€‰æ‹©æƒé‡æ›´å¤§çš„å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ç®¡ç†é¡µé¢ä¸­è¿›è¡Œé…ç½®ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/1pAckEZN5ltXKWG.png" alt="image-20230306231500731" tabindex="0" loading="lazy"><figcaption>image-20230306231500731</figcaption></figure><p>æˆ–æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼š</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">borrowservice</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      discovery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8848</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        cluster-name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Chengdu</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # æƒé‡å¤§å°ï¼Œè¶Šå¤§è¶Šä¼˜å…ˆè°ƒç”¨ï¼Œé»˜è®¤ä¸º1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        weight</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.5</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡é…ç½®æƒé‡ï¼ŒæŸäº›æ€§èƒ½ä¸å¤ªå¥½çš„æœºå™¨å°±èƒ½å¤Ÿæ›´å°‘åœ°è¢«ä½¿ç”¨ï¼Œè€Œæ›´å¤šçš„ä½¿ç”¨é‚£äº›ç½‘ç»œè‰¯å¥½æ€§èƒ½æ›´é«˜çš„ä¸»æœºä¸Šçš„å®ä¾‹ã€‚</p><h3 id="é…ç½®ä¸­å¿ƒ" tabindex="-1"><a class="header-anchor" href="#é…ç½®ä¸­å¿ƒ"><span>é…ç½®ä¸­å¿ƒ</span></a></h3><p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†SpringCloud Configï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æœåŠ¡æ¥åŠ è½½è¿œç¨‹é…ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨è¿œç«¯é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶ã€‚</p><p>å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥åœ¨<code>bootstrap.yml</code>ä¸­é…ç½®è¿œç¨‹é…ç½®æ–‡ä»¶è·å–ï¼Œç„¶åå†è¿›å…¥åˆ°é…ç½®æ–‡ä»¶åŠ è½½ç¯èŠ‚ï¼Œè€ŒNacosä¹Ÿæ”¯æŒè¿™æ ·çš„æ“ä½œï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦å°†å€Ÿé˜…æœåŠ¡çš„é…ç½®æ–‡ä»¶æ”¾åˆ°Nacosè¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨Nacosä¸­åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/6j2pAmdfyIGz9Cu.png" alt="image-20230306231534251" tabindex="0" loading="lazy"><figcaption>image-20230306231534251</figcaption></figure><p>å°†å€Ÿé˜…æœåŠ¡çš„é…ç½®æ–‡ä»¶å…¨éƒ¨ï¼ˆå½“ç„¶æ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šå…¨éƒ¨CVçš„ï¼Œåªä¼šå¤åˆ¶é‚£äº›éœ€è¦ç»å¸¸ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œè¿™é‡Œä¸ºäº†çœäº‹å°±ç›´æ¥å…¨éƒ¨CVäº†ï¼‰å¤åˆ¶è¿‡æ¥ï¼Œæ³¨æ„<strong>Data ID</strong>çš„æ ¼å¼è·Ÿæˆ‘ä»¬ä¹‹å‰ä¸€æ ·ï¼Œ<code>åº”ç”¨åç§°-ç¯å¢ƒ.yml</code>ï¼Œå¦‚æœåªç¼–å†™åº”ç”¨åç§°ï¼Œé‚£ä¹ˆä»£è¡¨æ­¤é…ç½®æ–‡ä»¶æ— è®ºåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹éƒ½ä¼šä½¿ç”¨ï¼Œç„¶åæ¯ä¸ªé…ç½®æ–‡ä»¶éƒ½å¯ä»¥è¿›è¡Œåˆ†ç»„ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§åˆ†ç±»æ–¹å¼ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/7ACoW3txIsjLzu2.png" alt="image-20230306231514151" tabindex="0" loading="lazy"><figcaption>image-20230306231514151</figcaption></figure><p>å®Œæˆä¹‹åç‚¹å‡»å‘å¸ƒå³å¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/alFpWGfNejImQEw.png" alt="image-20230306231522828" tabindex="0" loading="lazy"><figcaption>image-20230306231522828</figcaption></figure><p>ç„¶ååœ¨é¡¹ç›®ä¸­å¯¼å…¥ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-bootstrap&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-alibaba-nacos-config&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æˆ‘ä»¬åœ¨å€Ÿé˜…æœåŠ¡ä¸­æ·»åŠ <code>bootstrap.yml</code>æ–‡ä»¶ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  	# æœåŠ¡åç§°å’Œé…ç½®æ–‡ä»¶ä¿æŒä¸€è‡´</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">borrowservice</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  profiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  	# ç¯å¢ƒä¹Ÿæ˜¯å’Œé…ç½®æ–‡ä»¶ä¿æŒä¸€è‡´</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    active</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dev</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      	# é…ç½®æ–‡ä»¶åç¼€å</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        file-extension</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">yml</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        # é…ç½®ä¸­å¿ƒæœåŠ¡å™¨åœ°å€ï¼Œä¹Ÿå°±æ˜¯Nacosåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8848</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æˆ‘ä»¬å¯åŠ¨æœåŠ¡è¯•è¯•çœ‹ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/5J4FfMgtGwZhP3C.png" alt="image-20230306231605960" tabindex="0" loading="lazy"><figcaption>image-20230306231605960</figcaption></figure><p>å¯ä»¥çœ‹åˆ°æˆåŠŸè¯»å–é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨äº†ï¼Œå®é™…ä¸Šä½¿ç”¨ä¸Šæ¥è¯´è·Ÿä¹‹å‰çš„Configæ˜¯åŸºæœ¬ä¸€è‡´çš„ã€‚</p><p>Nacosè¿˜æ”¯æŒé…ç½®æ–‡ä»¶çš„çƒ­æ›´æ–°ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œè€Œè¿™ä¸ªæ—¶å€™å¯èƒ½éœ€è¦å®æ—¶ä¿®æ”¹ï¼Œå¹¶åœ¨åç«¯å®æ—¶æ›´æ–°ï¼Œé‚£ä¹ˆè¿™ç§è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„Controllerï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TestController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Value</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;${test.txt}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//æˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–test.txtçš„å­—ç¬¦ä¸²å€¼ï¼Œä½œä¸ºtestæ¥å£çš„è¿”å›å€¼</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> txt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> txt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡å¯æœåŠ¡å™¨ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/9xthuBpgFs4PTSq.png" alt="image-20230306231616512" tabindex="0" loading="lazy"><figcaption>image-20230306231616512</figcaption></figure><p>å¯ä»¥çœ‹åˆ°å·²ç»å¯ä»¥æ­£å¸¸è¯»å–äº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/kacrSVGYMpwK2jx.png" alt="image-20230306231626447" tabindex="0" loading="lazy"><figcaption>image-20230306231626447</figcaption></figure><p>ç°åœ¨æˆ‘ä»¬å°†é…ç½®æ–‡ä»¶çš„å€¼è¿›è¡Œä¿®æ”¹ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/YLC2H6yGoVi5z1f.png" alt="image-20230306231634007" tabindex="0" loading="lazy"><figcaption>image-20230306231634007</figcaption></figure><p>å†æ¬¡è®¿é—®æ¥å£ï¼Œä¼šå‘ç°æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/isTaOUQwMVWGCY9.png" alt="image-20230306231641913" tabindex="0" loading="lazy"><figcaption>image-20230306231641913</figcaption></figure><p>ä½†æ˜¯åå°æ˜¯æˆåŠŸæ£€æµ‹åˆ°å€¼æ›´æ–°äº†ï¼Œä½†æ˜¯å€¼å´æ²¡æ”¹å˜ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/dR4thB5JTk1cGjm.png" alt="image-20230306231656905" tabindex="0" loading="lazy"><figcaption>image-20230306231656905</figcaption></figure><p>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å®ç°é…ç½®çƒ­æ›´æ–°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RefreshScope</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   //æ·»åŠ æ­¤æ³¨è§£å°±èƒ½å®ç°è‡ªåŠ¨åˆ·æ–°äº†</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TestController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Value</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;${test.txt}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> txt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> txt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯æœåŠ¡å™¨ï¼Œå†æ¬¡é‡å¤ä¸Šè¿°å®éªŒï¼ŒæˆåŠŸã€‚</p><h3 id="å‘½åç©ºé—´" tabindex="-1"><a class="header-anchor" href="#å‘½åç©ºé—´"><span>å‘½åç©ºé—´</span></a></h3><p>æˆ‘ä»¬è¿˜å¯ä»¥å°†é…ç½®æ–‡ä»¶æˆ–æ˜¯æœåŠ¡å®ä¾‹åˆ’åˆ†åˆ°ä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œå…¶å®å°±æ˜¯åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒæˆ–æ˜¯å¼•ç”¨å½’å±ä¹‹ç±»çš„ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/7itUIhz3NupRdr6.png" alt="image-20230306231706215" tabindex="0" loading="lazy"><figcaption>image-20230306231706215</figcaption></figure><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/DC2I1MvVFjYmPEq.png" alt="image-20230306231713676" tabindex="0" loading="lazy"><figcaption>image-20230306231713676</figcaption></figure><p>å¯ä»¥çœ‹åˆ°åœ¨devå‘½åç©ºé—´ä¸‹ï¼Œæ²¡æœ‰ä»»ä½•é…ç½®æ–‡ä»¶å’ŒæœåŠ¡ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/Ek4APjgGcqbitNm.png" alt="image-20230306231723164" tabindex="0" loading="lazy"><figcaption>image-20230306231723164</figcaption></figure><p>æˆ‘ä»¬åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸‹ï¼Œå®ä¾‹å’Œé…ç½®éƒ½æ˜¯ç›¸äº’ä¹‹é—´éš”ç¦»çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå½“å‰çš„å‘½åç©ºé—´ã€‚</p><h3 id="å®ç°é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#å®ç°é«˜å¯ç”¨"><span>å®ç°é«˜å¯ç”¨</span></a></h3><p>ç”±äºNacosæš‚ä¸æ”¯æŒArmæ¶æ„èŠ¯ç‰‡çš„Macé›†ç¾¤æ­å»ºï¼Œæœ¬å°èŠ‚ç”¨Linxuäº‘ä¸»æœºï¼ˆNacosæ¯”è¾ƒåƒå†…å­˜ï¼Œ2ä¸ªNacosæœåŠ¡å™¨é›†ç¾¤ï¼Œè‡³å°‘2Gå†…å­˜ï¼‰ç¯å¢ƒæ¼”ç¤ºã€‚</p><p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨Nacosä»¥åŠNacosçš„åŠŸèƒ½ç­‰ï¼Œæœ€åæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚æœåƒä¹‹å‰Eurekaä¸€æ ·ï¼Œæ­å»ºNacosé›†ç¾¤ï¼Œå®ç°é«˜å¯ç”¨ã€‚</p><p>å®˜æ–¹æ–¹æ¡ˆï¼šhttps://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</p><figure><img src="https://s2.loli.net/2023/03/06/H1AvxOK78yspP5k.jpg" alt="deployDnsVipMode.jpg" tabindex="0" loading="lazy"><figcaption>deployDnsVipMode.jpg</figcaption></figure><blockquote><p>http://ip1:port/openAPI ç›´è¿ipæ¨¡å¼ï¼Œæœºå™¨æŒ‚åˆ™éœ€è¦ä¿®æ”¹ipæ‰å¯ä»¥ä½¿ç”¨ã€‚</p><p>http://SLB:port/openAPI æŒ‚è½½SLBæ¨¡å¼(å†…ç½‘SLBï¼Œä¸å¯æš´éœ²åˆ°å…¬ç½‘ï¼Œä»¥å…å¸¦æ¥å®‰å…¨é£é™©)ï¼Œç›´è¿SLBå³å¯ï¼Œä¸‹é¢æŒ‚serverçœŸå®ipï¼Œå¯è¯»æ€§ä¸å¥½ã€‚</p><p>http://nacos.com:port/openAPI åŸŸå + SLBæ¨¡å¼(å†…ç½‘SLBï¼Œä¸å¯æš´éœ²åˆ°å…¬ç½‘ï¼Œä»¥å…å¸¦æ¥å®‰å…¨é£é™©)ï¼Œå¯è¯»æ€§å¥½ï¼Œè€Œä¸”æ¢ipæ–¹ä¾¿ï¼Œæ¨èæ¨¡å¼</p></blockquote><p>æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æ¶æ„è®¾è®¡ï¼Œå®ƒæ¨èæˆ‘ä»¬åœ¨æ‰€æœ‰çš„NacosæœåŠ¡ç«¯ä¹‹å‰å»ºç«‹ä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬é€šè¿‡è®¿é—®è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ¥é—´æ¥è®¿é—®åˆ°å„ä¸ªNacosæœåŠ¡å™¨ã€‚å®é™…ä¸Šå°±ï¼Œæ˜¯æ¯”å¦‚æœ‰ä¸‰ä¸ªNacosæœåŠ¡å™¨åšé›†ç¾¤ï¼Œä½†æ˜¯æ¯ä¸ªæœåŠ¡ä¸å¯èƒ½æŠŠæ¯ä¸ªNacoséƒ½å»è®¿é—®ä¸€æ¬¡è¿›è¡Œæ³¨å†Œï¼Œå®é™…ä¸Šåªéœ€è¦åœ¨ä»»æ„ä¸€å°NacosæœåŠ¡å™¨ä¸Šæ³¨å†Œå³å¯ï¼ŒNacosæœåŠ¡å™¨ä¹‹é—´ä¼šè‡ªåŠ¨åŒæ­¥ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éšä¾¿æŒ‡å®šä¸€å°NacosæœåŠ¡å™¨è¿›è¡Œæ³¨å†Œï¼Œå¦‚æœè¿™å°NacosæœåŠ¡å™¨æŒ‚äº†ï¼Œä½†æ˜¯å…¶ä»–NacosæœåŠ¡å™¨æ²¡æŒ‚ï¼Œè¿™æ ·å°±æ²¡åŠæ³•å®Œæˆæ³¨å†Œäº†ï¼Œä½†æ˜¯å®é™…ä¸Šæ•´ä¸ªé›†ç¾¤è¿˜æ˜¯å¯ç”¨çš„çŠ¶æ€ã€‚</p><p>æ‰€ä»¥è¿™é‡Œå°±éœ€è¦åœ¨æ‰€æœ‰NacosæœåŠ¡å™¨ä¹‹å‰æ­å»ºä¸€ä¸ªSLBï¼ˆæœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä¸Šé¢çš„é—®é¢˜äº†ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœè¦å®ç°å¤–ç•Œå¯¹æœåŠ¡è®¿é—®çš„è´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬å°±å¾—ç”¨æ¯”å¦‚ä¹‹å‰è¯´åˆ°çš„Gatewayæ¥å®ç°ï¼Œè€Œè¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ›´åŠ æ–¹ä¾¿çš„å·¥å…·ï¼šNginxï¼Œæ¥å®ç°ï¼ˆä¹‹å‰æˆ‘ä»¬æ²¡è®²è¿‡ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæ”¾å¿ƒåé¢ä¼šå¸¦ç€å¤§å®¶ä½¿ç”¨ï¼‰</p><p>å…³äºSLBæœ€ä¸Šæ–¹è¿˜æœ‰ä¸€ä¸ªDNSï¼ˆæˆ‘ä»¬åœ¨<code>è®¡ç®—æœºç½‘ç»œ</code>è¿™é—¨è¯¾ç¨‹ä¸­å­¦ä¹ è¿‡ï¼‰ï¼Œè¿™ä¸ªæ˜¯å› ä¸ºSLBæ˜¯è£¸IPï¼Œå¦‚æœSLBæœåŠ¡å™¨ä¿®æ”¹äº†åœ°å€ï¼Œé‚£ä¹ˆæ‰€æœ‰å¾®æœåŠ¡æ³¨å†Œçš„åœ°å€ä¹Ÿå¾—æ”¹ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯é€šè¿‡åŠ åŸŸåï¼Œé€šè¿‡åŸŸåæ¥è®¿é—®ï¼Œè®©DNSå»è§£æçœŸå®IPï¼Œè¿™æ ·å°±ç®—æ”¹å˜IPï¼Œåªéœ€è¦ä¿®æ”¹åŸŸåè§£æè®°å½•å³å¯ï¼ŒåŸŸååœ°å€æ˜¯ä¸ä¼šå˜åŒ–çš„ã€‚</p><p>æœ€åå°±æ˜¯Nacosçš„æ•°æ®å­˜å‚¨æ¨¡å¼ï¼Œåœ¨å•èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼ŒNacoså®é™…ä¸Šæ˜¯å°†æ•°æ®å­˜æ”¾åœ¨è‡ªå¸¦çš„ä¸€ä¸ªåµŒå…¥å¼æ•°æ®åº“ä¸­ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/Fuxq9Dl3rGfnTZA.png" alt="image-20230306231744022" tabindex="0" loading="lazy"><figcaption>image-20230306231744022</figcaption></figure><p>è€Œè¿™ç§æ¨¡å¼åªé€‚ç”¨äºå•èŠ‚ç‚¹ï¼Œåœ¨å¤šèŠ‚ç‚¹é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œè‚¯å®šæ˜¯ä¸èƒ½å„å­˜å„çš„ï¼Œæ‰€ä»¥ï¼ŒNacosæä¾›äº†MySQLç»Ÿä¸€å­˜å‚¨æ”¯æŒï¼Œæˆ‘ä»¬åªéœ€è¦è®©æ‰€æœ‰çš„NacosæœåŠ¡å™¨è¿æ¥MySQLè¿›è¡Œæ•°æ®å­˜å‚¨å³å¯ï¼Œå®˜æ–¹ä¹Ÿæä¾›å¥½äº†SQLæ–‡ä»¶ã€‚</p><p>ç°åœ¨å°±å¯ä»¥å¼€å§‹äº†ï¼Œç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬ç›´æ¥å¯¼å…¥æ•°æ®åº“å³å¯ï¼Œæ–‡ä»¶åœ¨confç›®å½•ä¸­ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/97suBpfdeF54rc2.png" alt="image-20230306231753589" tabindex="0" loading="lazy"><figcaption>image-20230306231753589</figcaption></figure><p>æˆ‘ä»¬æ¥å°†å…¶å¯¼å…¥åˆ°æ•°æ®åº“ï¼Œå¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†å¾ˆå¤šçš„è¡¨ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/cf76RJ9VUiQBlje.png" alt="image-20230306231802722" tabindex="0" loading="lazy"><figcaption>image-20230306231802722</figcaption></figure><p>ç„¶åæˆ‘ä»¬æ¥åˆ›å»ºä¸¤ä¸ªNacosæœåŠ¡å™¨ï¼Œåšä¸€ä¸ªè¿·ä½ çš„é›†ç¾¤ï¼Œè¿™é‡Œä½¿ç”¨<code>scp</code>å‘½ä»¤å°†nacosæœåŠ¡ç«¯ä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨ï¼ˆæ³¨æ„éœ€è¦æå‰å®‰è£…å¥½JRE 8æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç¯å¢ƒï¼‰ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/RW4JIBKVXSbG3lZ.png" alt="image-20230306231811912" tabindex="0" loading="lazy"><figcaption>image-20230306231811912</figcaption></figure><p>è§£å‹ä¹‹åï¼Œæˆ‘ä»¬å¯¹å…¶é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œé¦–å…ˆæ˜¯<code>application.properties</code>é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼ŒåŒ…æ‹¬MySQLæœåŠ¡å™¨çš„ä¿¡æ¯ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">### Default web server port:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">server.port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">8801</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#*************** Config Module Related Configurations ***************#</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">### If use MySQL as datasource:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">spring.datasource.platform</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">mysql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">### Count of DB:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">db.num</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">### Connect URL of DB:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">db.url.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">jdbc:mysql://cloudstudy.mysql.cn-chengdu.rds.aliyuncs.com:3306/nacos?</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">characterEncoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">utf8&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">connectTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">1000&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">socketTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">3000&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">autoReconnect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">useUnicode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">true&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">useSSL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">false&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">serverTimezone</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">UTC</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">db.user.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">db.password.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">nacos</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åä¿®æ”¹é›†ç¾¤é…ç½®ï¼Œè¿™é‡Œéœ€è¦é‡å‘½åä¸€ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/2pe51dHQsJkPVY7.png" alt="image-20230306231821488" tabindex="0" loading="lazy"><figcaption>image-20230306231821488</figcaption></figure><p>ç«¯å£è®°å¾—ä½¿ç”¨å†…ç½‘IPåœ°å€ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/5CbEGQ7rX2StUkR.png" alt="image-20230306231828707" tabindex="0" loading="lazy"><figcaption>image-20230306231828707</figcaption></figure><p>æœ€åæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹Nacosçš„å†…å­˜åˆ†é…ä»¥åŠå‰å°å¯åŠ¨ï¼Œç›´æ¥ä¿®æ”¹<code>startup.sh</code>æ–‡ä»¶ï¼ˆå†…å­˜æœ‰é™ï¼Œç©ä¸èµ·é«˜çš„ï¼‰ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/kQF3lN24vcBqzDi.png" alt="image-20230306231836711" tabindex="0" loading="lazy"><figcaption>image-20230306231836711</figcaption></figure><p>ä¿å­˜ä¹‹åï¼Œå°†nacoså¤åˆ¶ä¸€ä»½ï¼Œå¹¶å°†ç«¯å£ä¿®æ”¹ä¸º8802ï¼Œæ¥ç€å¯åŠ¨è¿™ä¸¤ä¸ªNacosæœåŠ¡å™¨ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/PQYi69aKZUXrNlJ.png" alt="image-20230306231845850" tabindex="0" loading="lazy"><figcaption>image-20230306231845850</figcaption></figure><p>ç„¶åæˆ‘ä»¬æ‰“å¼€ç®¡ç†é¢æ¿ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å·²ç»å¯åŠ¨äº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/Lbf14V39SCdghvO.png" alt="image-20230306231854072" tabindex="0" loading="lazy"><figcaption>image-20230306231854072</figcaption></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬ç¬¬äºŒæ­¥å°±å®Œæˆäº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªSLBï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨Nginxåšåå‘ä»£ç†ï¼š</p><blockquote><p><em>Nginx</em> (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<a href="https://baike.baidu.com/item/HTTP" target="_blank" rel="noopener noreferrer">HTTP</a>å’Œ<a href="https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488" target="_blank" rel="noopener noreferrer">åå‘ä»£ç†</a>webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†IMAP/POP3/SMTPæœåŠ¡ã€‚å®ƒç›¸å½“äºåœ¨å†…ç½‘ä¸å¤–ç½‘ä¹‹é—´å½¢æˆä¸€ä¸ªç½‘å…³ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½å¯ä»¥ç”±NginxæœåŠ¡å™¨è½¬äº¤ç»™å†…ç½‘çš„å…¶ä»–æœåŠ¡å™¨ã€‚</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥å®‰è£…ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ç›´æ¥è¯·æ±‚80ç«¯å£ä¹‹åå¾—åˆ°ï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/gVuMlAXcY34Ka2C.png" alt="image-20230306231903833" tabindex="0" loading="lazy"><figcaption>image-20230306231903833</figcaption></figure><p>ç°åœ¨æˆ‘ä»¬éœ€è¦è®©å…¶ä»£ç†æˆ‘ä»¬åˆšåˆšå¯åŠ¨çš„ä¸¤ä¸ªNacosæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œä¸€äº›é…ç½®ã€‚é…ç½®æ–‡ä»¶ä½äº<code>/etc/nginx/nginx.conf</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-conf line-numbers-mode" data-highlighter="shiki" data-ext="conf" data-title="conf" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>#æ·»åŠ æˆ‘ä»¬åœ¨ä¸Šæ¸¸åˆšåˆšåˆ›å»ºå¥½çš„ä¸¤ä¸ªnacosæœåŠ¡å™¨</span></span>
<span class="line"><span>upstream nacos-server {</span></span>
<span class="line"><span>        server 10.0.0.12:8801;</span></span>
<span class="line"><span>        server 10.0.0.12:8802;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>server {</span></span>
<span class="line"><span>        listen   80;</span></span>
<span class="line"><span>        server_name  1.14.121.107;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        location /nacos {</span></span>
<span class="line"><span>                proxy_pass http://nacos-server;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯NginxæœåŠ¡å™¨ï¼ŒæˆåŠŸè¿æ¥ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/2hrxcizHPvSq8be.png" alt="image-20230306231912734" tabindex="0" loading="lazy"><figcaption>image-20230306231912734</figcaption></figure><p>ç„¶åæˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡å…¨éƒ¨ä¿®æ”¹ä¸ºäº‘æœåŠ¡å™¨ä¸ŠNacosçš„åœ°å€ï¼Œå¯åŠ¨è¯•è¯•çœ‹ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/gdh43ciamLnBRFV.png" alt="image-20230306231925001" tabindex="0" loading="lazy"><figcaption>image-20230306231925001</figcaption></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æ­å»ºå¥½äº†Nacosé›†ç¾¤ã€‚</p><hr><figure><img src="https://s2.loli.net/2023/03/06/xnmustzRkFZJWIP.png" alt="image-20230306231932929" tabindex="0" loading="lazy"><figcaption>image-20230306231932929</figcaption></figure><h2 id="sentinel-æµé‡é˜²å«å…µ" tabindex="-1"><a class="header-anchor" href="#sentinel-æµé‡é˜²å«å…µ"><span>Sentinel æµé‡é˜²å«å…µ</span></a></h2><p><strong>æ³¨æ„ï¼š</strong> è¿™ä¸€ç« æœ‰ç‚¹å°ç»•ï¼Œæ€è·¯ç†æ¸…ã€‚</p><p>ç»è¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡å­˜åœ¨çš„é›ªå´©é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå¾®æœåŠ¡å‡ºç°é—®é¢˜ï¼Œæœ‰å¯èƒ½å¯¼è‡´æ•´ä¸ªé“¾è·¯ç›´æ¥ä¸å¯ç”¨ï¼Œè¿™ç§æ—¶å€™æˆ‘ä»¬å°±éœ€è¦è¿›è¡ŒåŠæ—¶çš„ç†”æ–­å’Œé™çº§ï¼Œè¿™äº›ç­–ç•¥ï¼Œæˆ‘ä»¬ä¹‹å‰é€šè¿‡ä½¿ç”¨Hystrixæ¥å®ç°ã€‚</p><p>SpringCloud Alibabaä¹Ÿæœ‰è‡ªå·±çš„å¾®æœåŠ¡å®¹é”™ç»„ä»¶ï¼Œä½†æ˜¯å®ƒç›¸æ¯”Hystrixæ›´åŠ çš„å¼ºå¤§ã€‚</p><blockquote><p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p></blockquote><p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p><ul><li><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</strong>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</li><li><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§</strong>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</li><li><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€</strong>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Apache Dubboã€gRPCã€Quarkus çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚åŒæ—¶ Sentinel æä¾› Java/Go/C++ ç­‰å¤šè¯­è¨€çš„åŸç”Ÿå®ç°ã€‚</li><li><strong>å®Œå–„çš„ SPI æ‰©å±•æœºåˆ¶</strong>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</li></ul><h3 id="å®‰è£…ä¸éƒ¨ç½²-1" tabindex="-1"><a class="header-anchor" href="#å®‰è£…ä¸éƒ¨ç½²-1"><span>å®‰è£…ä¸éƒ¨ç½²</span></a></h3><p>å’ŒNacosä¸€æ ·ï¼Œå®ƒæ˜¯ç‹¬ç«‹å®‰è£…å’Œéƒ¨ç½²çš„ï¼Œä¸‹è½½åœ°å€ï¼šhttps://github.com/alibaba/Sentinel/releases</p><figure><img src="https://s2.loli.net/2023/03/06/oZdLMAJaCD3Uw9F.png" alt="image-20230306231950297" tabindex="0" loading="lazy"><figcaption>image-20230306231950297</figcaption></figure><p>æ³¨æ„ä¸‹è½½ä¸‹æ¥ä¹‹åæ˜¯ä¸€ä¸ª<code>jar</code>æ–‡ä»¶ï¼ˆå…¶å®å°±æ˜¯ä¸ªSpringBooté¡¹ç›®ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨IDEAä¸­æ·»åŠ ä¸€äº›è¿è¡Œé…ç½®ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/Hjm4Z38s95YiFvI.png" alt="image-20230306232001525" tabindex="0" loading="lazy"><figcaption>image-20230306232001525</figcaption></figure><p>æ¥ç€å°±å¯ä»¥ç›´æ¥å¯åŠ¨å•¦ï¼Œå½“ç„¶é»˜è®¤ç«¯å£å ç”¨8080ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ï¼Œå¯ä»¥æ·»åŠ ç¯å¢ƒå˜é‡ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/RfVAdtOqJjWlx6E.png" alt="image-20230306232012301" tabindex="0" loading="lazy"><figcaption>image-20230306232012301</figcaption></figure><p>å¯åŠ¨ä¹‹åï¼Œå°±å¯ä»¥è®¿é—®åˆ°Sentinelçš„ç›‘æ§é¡µé¢äº†ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯<code>sentinel</code>ï¼Œåœ°å€ï¼šhttp://localhost:8858/#/dashboard</p><figure><img src="https://s2.loli.net/2023/03/06/QpVRTYtBX6kvj2b.png" alt="image-20230306232020492" tabindex="0" loading="lazy"><figcaption>image-20230306232020492</figcaption></figure><p>è¿™æ ·å°±æˆåŠŸå¼€å¯ç›‘æ§é¡µé¢äº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬çš„æœåŠ¡è¿æ¥åˆ°Sentinelæ§åˆ¶å°ï¼Œè€è§„çŸ©ï¼Œå¯¼å…¥ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-alibaba-sentinel&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ Sentinelç›¸å…³ä¿¡æ¯ï¼ˆå®é™…ä¸ŠSentinelæ˜¯æœ¬åœ°åœ¨è¿›è¡Œç®¡ç†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿æ¥åˆ°ç›‘æ§é¡µé¢ï¼Œè¿™æ ·å°±å¯ä»¥å›¾å½¢åŒ–æ“ä½œäº†ï¼‰ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">userservice</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      discovery</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8848</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    sentinel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      transport</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      	# æ·»åŠ ç›‘æ§é¡µé¢åœ°å€å³å¯</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        dashboard</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8858</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡ï¼Œç„¶åè®¿é—®ä¸€æ¬¡æœåŠ¡ï¼Œè¿™æ ·Sentinelä¸­å°±ä¼šå­˜åœ¨ä¿¡æ¯äº†ï¼ˆæ‡’åŠ è½½æœºåˆ¶ï¼Œä¸ä¼šä¸€ä¸Šæ¥å°±åŠ è½½ï¼‰ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/p4KTaDd1wc5BR92.png" alt="image-20230306232031800" tabindex="0" loading="lazy"><figcaption>image-20230306232031800</figcaption></figure><figure><img src="https://s2.loli.net/2023/03/06/pzOus21AWqLfr9k.png" alt="image-20230306232038728" tabindex="0" loading="lazy"><figcaption>image-20230306232038728</figcaption></figure><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åœ¨Sentinelæ§åˆ¶å°ä¸­å¯¹æˆ‘ä»¬çš„æœåŠ¡è¿è¡Œæƒ…å†µè¿›è¡Œå®æ—¶ç›‘æ§äº†ï¼Œå¯ä»¥çœ‹åˆ°ç›‘æ§çš„å†…å®¹éå¸¸çš„å¤šï¼ŒåŒ…æ‹¬æ—¶é—´ç‚¹ã€QPS(æ¯ç§’æŸ¥è¯¢ç‡)ã€å“åº”æ—¶é—´ç­‰æ•°æ®ã€‚</p><p>æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡å…¨éƒ¨è¿æ¥åˆ°Sentinelç®¡ç†é¢æ¿ä¸­ã€‚</p><h3 id="æµé‡æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#æµé‡æ§åˆ¶"><span>æµé‡æ§åˆ¶</span></a></h3><p>å‰é¢æˆ‘ä»¬å®Œæˆäº†å¯¹Sentinelçš„æ­å»ºä¸è¿æ¥ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹Sentinelçš„ç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼Œæµé‡æ§åˆ¶ã€‚</p><p>æˆ‘ä»¬çš„æœºå™¨ä¸å¯èƒ½æ— é™åˆ¶çš„æ¥å—å’Œå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¦‚æœä¸åŠ ä»¥é™åˆ¶ï¼Œå½“å‘ç”Ÿé«˜å¹¶å‘æƒ…å†µæ—¶ï¼Œç³»ç»Ÿèµ„æºå°†å¾ˆå¿«è¢«è€—å°½ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¯ä»¥æ·»åŠ æµé‡æ§åˆ¶ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯é™æµï¼‰å½“ä¸€æ®µæ—¶é—´å†…çš„æµé‡åˆ°è¾¾ä¸€å®šçš„é˜ˆå€¼çš„æ—¶å€™ï¼Œæ–°çš„è¯·æ±‚å°†ä¸å†è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥åˆç†åœ°åº”å¯¹é«˜å¹¶å‘è¯·æ±‚ï¼ŒåŒæ—¶ä¹Ÿèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤æœåŠ¡å™¨ä¸å—åˆ°å¤–ç•Œçš„æ¶æ„æ”»å‡»ã€‚</p><p>é‚£ä¹ˆè¦å®ç°é™æµï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯¥é‡‡å–ä»€ä¹ˆæ ·çš„ç­–ç•¥å‘¢ï¼Ÿ</p><ul><li>æ–¹æ¡ˆä¸€ï¼š<strong>å¿«é€Ÿæ‹’ç»</strong>ï¼Œæ—¢ç„¶ä¸å†æ¥å—æ–°çš„è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªæ‹’ç»ä¿¡æ¯ï¼Œå‘Šè¯‰ç”¨æˆ·è®¿é—®é¢‘ç‡è¿‡é«˜ã€‚</li><li>æ–¹æ¡ˆäºŒï¼š<strong>é¢„çƒ­</strong>ï¼Œä¾ç„¶åŸºäºæ–¹æ¡ˆä¸€ï¼Œä½†æ˜¯ç”±äºæŸäº›æƒ…å†µä¸‹é«˜å¹¶å‘è¯·æ±‚æ˜¯åœ¨æŸä¸€æ—¶åˆ»çªç„¶åˆ°æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç¼“æ…¢åœ°å°†é˜ˆå€¼æé«˜åˆ°æŒ‡å®šé˜ˆå€¼ï¼Œå½¢æˆä¸€ä¸ªç¼“å†²ä¿æŠ¤ã€‚</li><li>æ–¹æ¡ˆä¸‰ï¼š<strong>æ’é˜Ÿç­‰å¾…</strong>ï¼Œä¸æ¥å—æ–°çš„è¯·æ±‚ï¼Œä½†æ˜¯ä¹Ÿä¸ç›´æ¥æ‹’ç»ï¼Œè€Œæ˜¯è¿›é˜Ÿåˆ—å…ˆç­‰ä¸€ä¸‹ï¼Œå¦‚æœè§„å®šæ—¶é—´å†…èƒ½å¤Ÿæ‰§è¡Œï¼Œé‚£ä¹ˆå°±æ‰§è¡Œï¼Œè¦æ˜¯è¶…æ—¶å°±ç®—äº†ã€‚</li></ul><p>é’ˆå¯¹äºæ˜¯å¦è¶…è¿‡æµé‡é˜ˆå€¼çš„åˆ¤æ–­ï¼Œè¿™é‡Œæˆ‘ä»¬æ4ç§ç®—æ³•ï¼š</p><ol><li><p><strong>æ¼æ¡¶ç®—æ³•</strong></p><p>é¡¾åæ€ä¹‰ï¼Œå°±åƒä¸€ä¸ªæ¡¶å¼€äº†ä¸€ä¸ªå°å­”ï¼Œæ°´æµè¿›æ¡¶ä¸­çš„é€Ÿåº¦è‚¯å®šæ˜¯è¿œå¤§äºæ°´æµå‡ºæ¡¶çš„é€Ÿåº¦çš„ï¼Œè¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ç§é™æµæ€è·¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/dMZVz3kDRxYaHg5.png" alt="image-20230306232054430" tabindex="0" loading="lazy"><figcaption>image-20230306232054430</figcaption></figure><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ¡¶æ˜¯æœ‰å®¹é‡çš„ï¼Œæ‰€ä»¥å½“æ¡¶çš„å®¹é‡å·²æ»¡æ—¶ï¼Œå°±è£…ä¸ä¸‹æ°´äº†ï¼Œè¿™æ—¶å°±åªæœ‰ä¸¢å¼ƒè¯·æ±‚äº†ã€‚</p><p>åˆ©ç”¨è¿™ç§æ€æƒ³ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä¸€ä¸ªç®€å•çš„é™æµç®—æ³•ã€‚</p></li><li><p><strong>ä»¤ç‰Œæ¡¶ç®—æ³•</strong></p><p>åªèƒ½è¯´æœ‰ç‚¹åƒä¿¡å·é‡æœºåˆ¶ã€‚ç°åœ¨æœ‰ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œè¿™ä¸ªæ¡¶æ˜¯ä¸“é—¨å­˜æ”¾ä»¤ç‰Œçš„ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±å‘æ¡¶ä¸­ä¸¢å…¥ä¸€ä¸ªä»¤ç‰Œï¼ˆé€Ÿåº¦ç”±æˆ‘ä»¬æŒ‡å®šï¼‰å½“æ–°çš„è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå°†ä»æ¡¶ä¸­åˆ é™¤ä»¤ç‰Œï¼Œæ¥ç€è¯·æ±‚å°±å¯ä»¥é€šè¿‡å¹¶ç»™åˆ°æœåŠ¡ï¼Œä½†æ˜¯å¦‚æœæ¡¶ä¸­çš„ä»¤ç‰Œæ•°é‡ä¸è¶³ï¼Œé‚£ä¹ˆä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œè€Œæ˜¯è®©æ­¤æ•°æ®åŒ…ç­‰å¾…ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/F1RxtgBZNQvWpw8.png" alt="image-20230306232102462" tabindex="0" loading="lazy"><figcaption>image-20230306232102462</figcaption></figure><p>å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå½“æµé‡ä¸‹é™æ—¶ï¼Œä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œä¼šé€æ¸ç§¯ç´¯ï¼Œè¿™æ ·å¦‚æœçªç„¶å‡ºç°é«˜å¹¶å‘ï¼Œé‚£ä¹ˆå°±èƒ½åœ¨çŸ­æ—¶é—´å†…æ‹¿åˆ°å¤§é‡çš„ä»¤ç‰Œã€‚</p></li><li><p><strong>å›ºå®šæ—¶é—´çª—å£ç®—æ³•</strong></p><p>æˆ‘ä»¬å¯ä»¥å¯¹æŸä¸€ä¸ªæ—¶é—´æ®µå†…çš„è¯·æ±‚è¿›è¡Œç»Ÿè®¡å’Œè®¡æ•°ï¼Œæ¯”å¦‚åœ¨<code>14:15</code>åˆ°<code>14:16</code>è¿™ä¸€åˆ†é’Ÿå†…ï¼Œè¯·æ±‚é‡ä¸èƒ½è¶…è¿‡<code>100</code>ï¼Œä¹Ÿå°±æ˜¯ä¸€åˆ†é’Ÿä¹‹å†…ä¸èƒ½è¶…è¿‡<code>100</code>æ¬¡è¯·æ±‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·è¿›è¡Œåˆ’åˆ†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/XRnKgCivsqFE2ax.png" alt="image-20230306232111506" tabindex="0" loading="lazy"><figcaption>image-20230306232111506</figcaption></figure><p>è™½ç„¶è¿™ç§æ¨¡å¼çœ‹ä¼¼æ¯”è¾ƒåˆç†ï¼Œä½†æ˜¯è¯•æƒ³ä¸€ä¸‹è¿™ç§æƒ…å†µï¼š</p><ul><li>14:15:59çš„æ—¶å€™æ¥äº†100ä¸ªè¯·æ±‚</li><li>14:16:01çš„æ—¶å€™åˆæ¥äº†100ä¸ªè¯·æ±‚</li></ul><p>å‡ºç°ä¸Šé¢è¿™ç§æƒ…å†µï¼Œç¬¦åˆå›ºå®šæ—¶é—´çª—å£ç®—æ³•çš„è§„åˆ™ï¼Œæ‰€ä»¥è¿™200ä¸ªè¯·æ±‚éƒ½èƒ½æ­£å¸¸æ¥å—ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ ååº”æ¯”è¾ƒå¿«ï¼Œåº”è¯¥å‘ç°äº†ï¼Œæˆ‘ä»¬å…¶å®å¸Œæœ›çš„æ˜¯60ç§’å†…åªæœ‰100ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µå´æ˜¯åœ¨3ç§’å†…å‡ºç°äº†200ä¸ªè¯·æ±‚ï¼Œå¾ˆæ˜æ˜¾å·²ç»è¿èƒŒäº†æˆ‘ä»¬çš„åˆè¡·ã€‚</p><p>å› æ­¤ï¼Œå½“é‡åˆ°ä¸´ç•Œç‚¹æ—¶ï¼Œå›ºå®šæ—¶é—´çª—å£ç®—æ³•å­˜åœ¨å®‰å…¨éšæ‚£ã€‚</p></li><li><p><strong>æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•</strong></p><p>ç›¸å¯¹äºå›ºå®šçª—å£ç®—æ³•ï¼Œæ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•æ›´åŠ çµæ´»ï¼Œå®ƒä¼šåŠ¨æ€ç§»åŠ¨çª—å£ï¼Œé‡æ–°è¿›è¡Œè®¡ç®—ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/8MyG3WDo1wSBb5Y.png" alt="image-20230306232118585" tabindex="0" loading="lazy"><figcaption>image-20230306232118585</figcaption></figure><p>è™½ç„¶è¿™æ ·èƒ½å¤Ÿé¿å…å›ºå®šæ—¶é—´çª—å£çš„ä¸´ç•Œé—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ˜¯æ¯”å›ºå®šçª—å£æ›´åŠ è€—æ—¶çš„ã€‚</p></li></ol><p>å¥½äº†ï¼Œäº†è§£å®Œäº†æˆ‘ä»¬çš„é™æµç­–ç•¥å’Œåˆ¤å®šæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åœ¨Sentinelä¸­è¿›è¡Œå®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œæ‰“å¼€ç®¡ç†é¡µé¢çš„ç°‡ç‚¹é“¾è·¯æ¨¡å—ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/4fPg72OJiwhDycL.png" alt="image-20230306232127628" tabindex="0" loading="lazy"><figcaption>image-20230306232127628</figcaption></figure><p>è¿™é‡Œæ¼”ç¤ºå¯¹æˆ‘ä»¬çš„å€Ÿé˜…æ¥å£è¿›è¡Œé™æµï¼Œç‚¹å‡»<code>æµæ§</code>ï¼Œä¼šçœ‹åˆ°è®©æˆ‘ä»¬æ·»åŠ æµæ§è§„åˆ™ï¼š</p><ul><li>é˜ˆå€¼ç±»å‹ï¼šQPSå°±æ˜¯æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡ï¼Œå¹¶å‘çº¿ç¨‹æ•°æ˜¯æŒ‰æœåŠ¡å½“å‰ä½¿ç”¨çš„çº¿ç¨‹æ•°æ®è¿›è¡Œç»Ÿè®¡çš„ã€‚</li><li>æµæ§æ¨¡å¼ï¼šå½“è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œæµæ§çš„å¯¹è±¡ï¼Œè¿™é‡Œæš‚æ—¶åªç”¨ç›´æ¥ã€‚</li><li>æµæ§æ•ˆæœï¼šå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„ä¸‰ç§æ–¹æ¡ˆã€‚</li></ul><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>QPS</code>ã€é˜ˆå€¼è®¾å®šä¸º<code>1</code>ï¼Œæµæ§æ¨¡å¼é€‰æ‹©<code>ç›´æ¥</code>ã€æµæ§æ•ˆæœé€‰æ‹©<code>å¿«é€Ÿå¤±è´¥</code>ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬å¿«é€Ÿåœ°è¿›è¡Œè¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥è¿”å›å¤±è´¥ä¿¡æ¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/Lrw7ZJNzyDUoYG8.png" alt="image-20230306232135482" tabindex="0" loading="lazy"><figcaption>image-20230306232135482</figcaption></figure><p>è¿™é‡Œå„ä½æœ€å¥½è‡ªè¡Œå°è¯•ä¸€ä¸‹å…¶ä»–çš„æµæ§æ•ˆæœï¼Œç†Ÿæ‚‰å’ŒåŠ æ·±å°è±¡ã€‚</p><p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›æµæ§æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p><ul><li>ç›´æ¥ï¼šåªé’ˆå¯¹äºå½“å‰æ¥å£ã€‚</li><li>å…³è”ï¼šå½“å…¶ä»–æ¥å£è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šå¯¼è‡´å½“å‰æ¥å£è¢«é™æµã€‚</li><li>é“¾è·¯ï¼šæ›´ç»†ç²’åº¦çš„é™æµï¼Œèƒ½ç²¾ç¡®åˆ°å…·ä½“çš„æ–¹æ³•ã€‚</li></ul><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å…³è”ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬å¯¹è‡ªå¸¦çš„<code>/error</code>æ¥å£è¿›è¡Œé™æµï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/E9vnJRTPZmzaW8V.png" alt="image-20230306232145053" tabindex="0" loading="lazy"><figcaption>image-20230306232145053</figcaption></figure><p>æ³¨æ„é™æµæ˜¯ä½œç”¨äºå…³è”èµ„æºçš„ï¼Œä¸€æ—¦å‘ç°å…³è”èµ„æºè¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹å½“å‰çš„èµ„æºè¿›è¡Œé™æµï¼Œæˆ‘ä»¬ç°åœ¨æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œä½¿ç”¨PostMançš„Runnerè¿ç»­å¯¹å…³è”èµ„æºå‘èµ·è¯·æ±‚ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/QgqsxdvYF59P7ne.png" alt="image-20230306232239339" tabindex="0" loading="lazy"><figcaption>image-20230306232239339</figcaption></figure><p>å¼€å¯Postmanï¼Œç„¶åæˆ‘ä»¬ä¼šå‘ç°å€Ÿé˜…æœåŠ¡å·²ç»å‡‰å‡‰ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/tnKXB2JUarehk5T.png" alt="image-20230306232253804" tabindex="0" loading="lazy"><figcaption>image-20230306232253804</figcaption></figure><p>å½“æˆ‘ä»¬å…³é—­æ‰Postmançš„ä»»åŠ¡åï¼Œæ¢å¤æ­£å¸¸ã€‚</p><p>æœ€åæˆ‘ä»¬æ¥è®²è§£ä¸€ä¸‹é“¾è·¯æ¨¡å¼ï¼Œå®ƒèƒ½å¤Ÿæ›´åŠ ç²¾å‡†çš„è¿›è¡Œæµé‡æ§åˆ¶ï¼Œé“¾è·¯æµæ§æ¨¡å¼æŒ‡çš„æ˜¯ï¼Œå½“ä»æŒ‡å®šæ¥å£è¿‡æ¥çš„èµ„æºè¯·æ±‚è¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œå¼€å¯é™æµï¼Œè¿™é‡Œå¾—å…ˆè®²è§£ä¸€ä¸‹<code>@SentinelResource</code>çš„ä½¿ç”¨ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å¯¹æŸä¸€ä¸ªæ–¹æ³•è¿›è¡Œé™æµæ§åˆ¶ï¼Œæ— è®ºæ˜¯è°åœ¨ä½•å¤„è°ƒç”¨äº†å®ƒï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨åˆ°<code>@SentinelResource</code>ï¼Œä¸€æ—¦æ–¹æ³•è¢«æ ‡æ³¨ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œç›‘æ§ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œåˆ›å»ºä¸¤ä¸ªè¯·æ±‚æ˜ å°„ï¼Œéƒ½æ¥è°ƒç”¨Serviceçš„è¢«ç›‘æ§æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BorrowController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BorrowService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/borrow/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findUserBorrows</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserBorrowDetailByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/borrow2/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findUserBorrows2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserBorrowDetailByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Service</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BorrowServiceImpl</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BorrowService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BorrowMapper</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    UserClient</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BookClient</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SentinelResource</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;getBorrow&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)   </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//ç›‘æ§æ­¤æ–¹æ³•ï¼Œæ— è®ºè¢«è°æ‰§è¡Œéƒ½åœ¨ç›‘æ§èŒƒå›´å†…ï¼Œè¿™é‡Œç»™çš„valueæ˜¯è‡ªå®šä¹‰åç§°ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥åŠ åœ¨ä»»ä½•æ–¹æ³•ä¸Šï¼ŒåŒ…æ‹¬Controllerä¸­çš„è¯·æ±‚æ˜ å°„æ–¹æ³•ï¼Œè·ŸHystrixCommandè´¼åƒ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserBorrowDetailByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Borrow</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">borrow</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBorrowsByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Book</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bookList</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> borrow</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">stream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(b </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">collect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Collectors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserBorrowDetail</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(user, bookList);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æ·»åŠ é…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">borrowservice</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    sentinel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      transport</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        dashboard</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8858</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      # å…³é—­Contextæ”¶æ•›ï¼Œè¿™æ ·è¢«ç›‘æ§æ–¹æ³•å¯ä»¥è¿›è¡Œä¸åŒé“¾è·¯çš„å•ç‹¬æ§åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      web-context-unify</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæˆ‘ä»¬åœ¨Sentinelæ§åˆ¶å°ä¸­æ·»åŠ æµæ§è§„åˆ™ï¼Œæ³¨æ„æ˜¯é’ˆå¯¹æ­¤æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»è‡ªåŠ¨è¯†åˆ«åˆ°borrowæ¥å£ä¸‹è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/FOzJdtoieAxIvPq.png" alt="image-20230306232304858" tabindex="0" loading="lazy"><figcaption>image-20230306232304858</figcaption></figure><p>æœ€åæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å¯¹è¿™ä¸¤ä¸ªæ¥å£éƒ½è¿›è¡Œæµ‹è¯•ï¼Œä¼šå‘ç°ï¼Œæ— è®ºè¯·æ±‚å“ªä¸ªæ¥å£ï¼Œåªè¦è°ƒç”¨äº†Serviceä¸­çš„<code>getUserBorrowDetailByUid</code>è¿™ä¸ªæ–¹æ³•ï¼Œéƒ½ä¼šè¢«é™æµã€‚æ³¨æ„é™æµçš„å½¢å¼æ˜¯åå°ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè‡³äºæ€ä¹ˆå¤„ç†æˆ‘ä»¬åé¢å†è¯´ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªé“¾è·¯é€‰é¡¹å®é™…ä¸Šå°±æ˜¯å†³å®šåªé™æµä»å“ªä¸ªæ–¹å‘æ¥çš„è°ƒç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬åªå¯¹<code>borrow2</code>è¿™ä¸ªæ¥å£å¯¹<code>getUserBorrowDetailByUid</code>æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œé™æµï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¸ºå…¶æŒ‡å®šé“¾è·¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/UHbcgSWV2exNCu1.png" alt="image-20230306232315010" tabindex="0" loading="lazy"><figcaption>image-20230306232315010</figcaption></figure><p>ç„¶åæˆ‘ä»¬ä¼šå‘ç°ï¼Œé™æµæ•ˆæœåªå¯¹æˆ‘ä»¬é…ç½®çš„é“¾è·¯æ¥å£æœ‰æ•ˆï¼Œè€Œå…¶ä»–é“¾è·¯æ˜¯ä¸ä¼šè¢«é™æµçš„ã€‚</p><p>é™¤äº†ç›´æ¥å¯¹æ¥å£è¿›è¡Œé™æµè§„åˆ™æ§åˆ¶ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å½“å‰ç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œå†³å®šæ˜¯å¦è¿›è¡Œé™æµï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/MHiDyU54L3QsNrc.png" alt="image-20230306232323438" tabindex="0" loading="lazy"><figcaption>image-20230306232323438</figcaption></figure><p>ç³»ç»Ÿè§„åˆ™æ”¯æŒä»¥ä¸‹çš„æ¨¡å¼ï¼š</p><ul><li><strong>Load è‡ªé€‚åº”</strong>ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ <code>maxQps * minRt</code> ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ <code>CPU cores * 2.5</code>ã€‚</li><li><strong>CPU usage</strong>ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚</li><li><strong>å¹³å‡ RT</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li><li><strong>å¹¶å‘çº¿ç¨‹æ•°</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li><li><strong>å…¥å£ QPS</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li></ul><p>è¿™é‡Œå°±ä¸è¿›è¡Œæ¼”ç¤ºäº†ã€‚</p><h3 id="é™æµå’Œå¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#é™æµå’Œå¼‚å¸¸å¤„ç†"><span>é™æµå’Œå¼‚å¸¸å¤„ç†</span></a></h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•è¿›è¡Œé™æµæ“ä½œï¼Œé‚£ä¹ˆé™æµçŠ¶æ€ä¸‹çš„è¿”å›ç»“æœè¯¥æ€ä¹ˆä¿®æ”¹å‘¢ï¼Œæˆ‘ä»¬çœ‹åˆ°è¢«é™æµä¹‹åè¿”å›çš„æ˜¯Sentinelé»˜è®¤çš„æ•°æ®ï¼Œç°åœ¨æˆ‘ä»¬å¸Œæœ›è‡ªå®šä¹‰æ”¹å¦‚ä½•æ“ä½œï¼Ÿ</p><p>è¿™é‡Œæˆ‘ä»¬å…ˆåˆ›å»ºå¥½è¢«é™æµçŠ¶æ€ä¸‹éœ€è¦è¿”å›çš„å†…å®¹ï¼Œå®šä¹‰ä¸€ä¸ªè¯·æ±‚æ˜ å°„ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/blocked&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">JSONObject</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> blocked</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    JSONObject</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> object </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> JSONObject</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    object</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;code&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">403</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    object</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;success&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    object</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;massage&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æ‚¨çš„è¯·æ±‚é¢‘ç‡è¿‡å¿«ï¼Œè¯·ç¨åå†è¯•ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> object</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å°†æ­¤é¡µé¢è®¾å®šä¸ºé™æµé¡µé¢ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cloud</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    sentinel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      transport</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        dashboard</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8858</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      # å°†åˆšåˆšç¼–å†™çš„è¯·æ±‚æ˜ å°„è®¾å®šä¸ºé™æµé¡µé¢</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      block-page</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/blocked</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå½“è¢«é™æµæ—¶ï¼Œå°±ä¼šè¢«é‡å®šå‘åˆ°æŒ‡å®šé¡µé¢ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/PfVOQWJrTiZGqh7.png" alt="image-20230306232335949" tabindex="0" loading="lazy"><figcaption>image-20230306232335949</figcaption></figure><p>é‚£ä¹ˆï¼Œå¯¹äºæ–¹æ³•çº§åˆ«çš„é™æµå‘¢ï¼Ÿç»è¿‡å‰é¢çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“ï¼Œå½“æŸä¸ªæ–¹æ³•è¢«é™æµæ—¶ï¼Œä¼šç›´æ¥åœ¨åå°æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µæˆ‘ä»¬è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰åœ¨Hystrixä¸­å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼Œè¿™æ ·å½“å‡ºç°å¼‚å¸¸æ—¶ä¼šç›´æ¥æ‰§è¡Œæˆ‘ä»¬çš„æ›¿ä»£æ–¹æ³•å¹¶è¿”å›ï¼ŒSentinelä¹Ÿå¯ä»¥ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬è¿˜æ˜¯åœ¨<code>getUserBorrowDetailByUid</code>æ–¹æ³•ä¸Šè¿›è¡Œé…ç½®ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SentinelResource</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;getBorrow&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> blockHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;blocked&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)   </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//æŒ‡å®šblockHandlerï¼Œä¹Ÿå°±æ˜¯è¢«é™æµä¹‹åçš„æ›¿ä»£è§£å†³æ–¹æ¡ˆï¼Œè¿™æ ·å°±ä¸ä¼šä½¿ç”¨é»˜è®¤çš„æŠ›å‡ºå¼‚å¸¸çš„å½¢å¼äº†</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserBorrowDetailByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> uid) {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Borrow</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> borrow </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBorrowsByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Book</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bookList </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> borrow</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">stream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(b </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">collect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Collectors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserBorrowDetail</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> bookList)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//æ›¿ä»£æ–¹æ¡ˆï¼Œæ³¨æ„å‚æ•°å’Œè¿”å›å€¼éœ€è¦ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”å‚æ•°æœ€åè¿˜éœ€è¦é¢å¤–æ·»åŠ ä¸€ä¸ªBlockException</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> blocked</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BlockException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> e) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserBorrowDetail</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Collections</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">emptyList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ—¦è¢«é™æµå°†æ‰§è¡Œæ›¿ä»£æ–¹æ¡ˆï¼Œæœ€åè¿”å›çš„ç»“æœå°±æ˜¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/p1Y53LPihOGZjBV.png" alt="image-20230306232346185" tabindex="0" loading="lazy"><figcaption>image-20230306232346185</figcaption></figure><p>æ³¨æ„<code>blockHandler</code>åªèƒ½å¤„ç†é™æµæƒ…å†µä¸‹æŠ›å‡ºçš„å¼‚å¸¸ï¼ŒåŒ…æ‹¬ä¸‹é¢å³å°†è¦ä»‹ç»çš„çƒ­ç‚¹å‚æ•°é™æµä¹Ÿæ˜¯åŒç†ï¼Œå¦‚æœæ˜¯æ–¹æ³•æœ¬èº«æŠ›å‡ºçš„å…¶ä»–ç±»å‹å¼‚å¸¸ï¼Œä¸åœ¨ç®¡æ§èŒƒå›´å†…ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–å‚æ•°è¿›è¡Œå¤„ç†ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SentinelResource</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        fallback</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;except&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    //fallbackæŒ‡å®šå‡ºç°å¼‚å¸¸æ—¶çš„æ›¿ä»£æ–¹æ¡ˆ</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        exceptionsToIgnore</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//å¿½ç•¥é‚£äº›å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›å¼‚å¸¸å‡ºç°æ—¶ä¸ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;HelloWorldï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//æ›¿ä»£æ–¹æ³•å¿…é¡»å’ŒåŸæ–¹æ³•è¿”å›å€¼å’Œå‚æ•°ä¸€è‡´ï¼Œæœ€åå¯ä»¥æ·»åŠ ä¸€ä¸ªThrowableä½œä¸ºå‚æ•°æ¥å—å¼‚å¸¸</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> except</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Throwable</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> t){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå…¶ä»–çš„å¼‚å¸¸ä¹Ÿå¯ä»¥æœ‰æ›¿ä»£æ–¹æ¡ˆäº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/pk1HjSi9VyxwOJQ.png" alt="image-20230306232354931" tabindex="0" loading="lazy"><figcaption>image-20230306232354931</figcaption></figure><p>ç‰¹åˆ«æ³¨æ„è¿™ç§æ–¹å¼ä¼šåœ¨æ²¡æœ‰é…ç½®<code>blockHandler</code>çš„æƒ…å†µä¸‹ï¼Œå°†Sentinelæœºåˆ¶å†…ï¼ˆä¹Ÿå°±æ˜¯é™æµçš„å¼‚å¸¸ï¼‰çš„å¼‚å¸¸ä¹Ÿä¸€å¹¶å¤„ç†äº†ï¼Œå¦‚æœé…ç½®äº†<code>blockHandler</code>ï¼Œé‚£ä¹ˆåœ¨å‡ºç°é™æµæ—¶ï¼Œä¾ç„¶åªä¼šæ‰§è¡Œ<code>blockHandler</code>æŒ‡å®šçš„æ›¿ä»£æ–¹æ¡ˆï¼ˆå› ä¸ºé™æµæ˜¯åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰è¿›è¡Œçš„ï¼‰</p><h3 id="çƒ­ç‚¹å‚æ•°é™æµ" tabindex="-1"><a class="header-anchor" href="#çƒ­ç‚¹å‚æ•°é™æµ"><span>çƒ­ç‚¹å‚æ•°é™æµ</span></a></h3><p>æˆ‘ä»¬è¿˜å¯ä»¥å¯¹æŸä¸€çƒ­ç‚¹æ•°æ®è¿›è¡Œç²¾å‡†é™æµï¼Œæ¯”å¦‚åœ¨æŸä¸€æ—¶åˆ»ï¼Œä¸åŒå‚æ•°è¢«æºå¸¦è®¿é—®çš„é¢‘ç‡æ˜¯ä¸ä¸€æ ·çš„ï¼š</p><ul><li>http://localhost:8301/test?a=10 è®¿é—®100æ¬¡</li><li>http://localhost:8301/test?b=10 è®¿é—®0æ¬¡</li><li>http://localhost:8301/test?c=10 è®¿é—®3æ¬¡</li></ul><p>ç”±äºæºå¸¦å‚æ•°<code>a</code>çš„è¯·æ±‚æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å°±å¯ä»¥åªå¯¹æºå¸¦å‚æ•°<code>a</code>çš„è¯·æ±‚è¿›è¡Œé™æµã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯•è¯·æ±‚æ˜ å°„ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SentinelResource</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)   </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//æ³¨æ„è¿™é‡Œéœ€è¦æ·»åŠ @SentinelResourceæ‰å¯ä»¥ï¼Œç”¨æˆ·èµ„æºåç§°å°±ä½¿ç”¨è¿™é‡Œå®šä¹‰çš„èµ„æºåç§°</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findUserBorrows2</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestParam</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;a&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> required</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestParam</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;b&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> required</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestParam</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;c&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">required</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> c) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;è¯·æ±‚æˆåŠŸï¼a = &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, b = &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">b</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, c = &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬åœ¨Sentinelé‡Œé¢è¿›è¡Œçƒ­ç‚¹é…ç½®ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/fIlhGM3jPxb7wgS.png" alt="image-20230306232406587" tabindex="0" loading="lazy"><figcaption>image-20230306232406587</figcaption></figure><p>ç„¶åå¼€å§‹è®¿é—®æˆ‘ä»¬çš„æµ‹è¯•æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æºå¸¦å‚æ•°aæ—¶ï¼Œå½“è®¿é—®é¢‘ç‡è¶…è¿‡è®¾å®šå€¼ï¼Œå°±ä¼šç›´æ¥è¢«é™æµï¼Œè¿™é‡Œæ˜¯ç›´æ¥åœ¨åå°æŠ›å‡ºå¼‚å¸¸ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/hskQVKnE2y5PftO.png" alt="image-20230306232452209" tabindex="0" loading="lazy"><figcaption>image-20230306232452209</figcaption></figure><figure><img src="https://s2.loli.net/2023/03/06/nC6W5T4OGcJNypA.png" alt="image-20230306232500754" tabindex="0" loading="lazy"><figcaption>image-20230306232500754</figcaption></figure><p>è€Œæˆ‘ä»¬ä½¿ç”¨å…¶ä»–å‚æ•°æˆ–æ˜¯ä¸å¸¦<code>a</code>å‚æ•°ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜äº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/WVguflyZ43NxE7j.png" alt="image-20230306232514532" tabindex="0" loading="lazy"><figcaption>image-20230306232514532</figcaption></figure><p>é™¤äº†ç›´æ¥å¯¹æŸä¸ªå‚æ•°ç²¾å‡†é™æµå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å‚æ•°æºå¸¦çš„æŒ‡å®šå€¼å•ç‹¬è®¾å®šé˜ˆå€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨ä¸ä»…å¸Œæœ›å¯¹å‚æ•°<code>a</code>é™æµï¼Œè€Œä¸”è¿˜å¸Œæœ›å½“å‚æ•°<code>a</code>çš„å€¼ä¸º10æ—¶ï¼ŒQPSè¾¾åˆ°5å†è¿›è¡Œé™æµï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¾å®šä¾‹å¤–ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/oipjTJBHsMSdDvc.png" alt="image-20230306232525342" tabindex="0" loading="lazy"><figcaption>image-20230306232525342</figcaption></figure><p>è¿™æ ·ï¼Œå½“è¯·æ±‚æºå¸¦å‚æ•°<code>a</code>ï¼Œä¸”å‚æ•°<code>a</code>çš„å€¼ä¸º10æ—¶ï¼Œé˜ˆå€¼å°†æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„ç‰¹ä¾‹è¿›è¡Œè®¡ç®—ã€‚</p><h3 id="æœåŠ¡ç†”æ–­å’Œé™çº§" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡ç†”æ–­å’Œé™çº§"><span>æœåŠ¡ç†”æ–­å’Œé™çº§</span></a></h3><p>è¿˜è®°å¾—æˆ‘ä»¬å‰æ‰€è¯´çš„æœåŠ¡é™çº§å—ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦åœ¨æ•´ä¸ªå¾®æœåŠ¡è°ƒç”¨é“¾è·¯å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼ŒåŠæ—¶å¯¹æœåŠ¡è¿›è¡Œé™çº§ï¼Œä»¥é˜²æ­¢é—®é¢˜è¿›ä¸€æ­¥æ¶åŒ–ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/AxrzjvtPWJ2YCZI.png" alt="image-20230306232538279" tabindex="0" loading="lazy"><figcaption>image-20230306232538279</figcaption></figure><p>é‚£ä¹ˆï¼Œå„ä½æ˜¯å¦æœ‰æ€è€ƒè¿‡ï¼Œå¦‚æœåœ¨æŸä¸€æ—¶åˆ»ï¼ŒæœåŠ¡Bå‡ºç°æ•…éšœï¼ˆå¯èƒ½å°±å¡åœ¨é‚£é‡Œäº†ï¼‰ï¼Œè€Œè¿™æ—¶æœåŠ¡Aä¾ç„¶æœ‰å¤§é‡çš„è¯·æ±‚ï¼Œåœ¨è°ƒç”¨æœåŠ¡Bï¼Œé‚£ä¹ˆï¼Œç”±äºæœåŠ¡Aæ²¡åŠæ³•å†çŸ­æ—¶é—´å†…å®Œæˆå¤„ç†ï¼Œæ–°æ¥çš„è¯·æ±‚å°±ä¼šå¯¼è‡´çº¿ç¨‹æ•°ä¸æ–­åœ°å¢åŠ ï¼Œè¿™æ ·ï¼ŒCPUçš„èµ„æºå¾ˆå¿«å°±ä¼šè¢«è€—å°½ã€‚</p><p>é‚£ä¹ˆè¦é˜²æ­¢è¿™ç§æƒ…å†µï¼Œå°±åªèƒ½è¿›è¡Œéš”ç¦»äº†ï¼Œè¿™é‡Œæˆ‘ä»¬æä¸¤ç§éš”ç¦»æ–¹æ¡ˆï¼š</p><ol><li><p><strong>çº¿ç¨‹æ± éš”ç¦»</strong></p><p>çº¿ç¨‹æ± éš”ç¦»å®é™…ä¸Šå°±æ˜¯å¯¹æ¯ä¸ªæœåŠ¡çš„è¿œç¨‹è°ƒç”¨å•ç‹¬å¼€æ”¾çº¿ç¨‹æ± ï¼Œæ¯”å¦‚æœåŠ¡Aè¦è°ƒç”¨æœåŠ¡Bï¼Œé‚£ä¹ˆåªåŸºäºå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± ï¼Œè¿™æ ·å³ä½¿åœ¨çŸ­æ—¶é—´å†…å‡ºç°å¤§é‡è¯·æ±‚ï¼Œç”±äºæ²¡æœ‰çº¿ç¨‹å¯ä»¥åˆ†é…ï¼Œæ‰€ä»¥å°±ä¸ä¼šå¯¼è‡´èµ„æºè€—å°½äº†ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/CbYxA3d7w46OlMm.png" alt="image-20230306232549778" tabindex="0" loading="lazy"><figcaption>image-20230306232549778</figcaption></figure></li><li><p><strong>ä¿¡å·é‡éš”ç¦»</strong></p><p>ä¿¡å·é‡éš”ç¦»æ˜¯ä½¿ç”¨<code>Semaphore</code>ç±»å®ç°çš„ï¼ˆå¦‚æœä¸äº†è§£ï¼Œå¯ä»¥è§‚çœ‹æœ¬ç³»åˆ— å¹¶å‘ç¼–ç¨‹ç¯‡ è§†é¢‘æ•™ç¨‹ï¼‰ï¼Œæ€æƒ³åŸºæœ¬ä¸Šä¸ä¸Šé¢æ˜¯ç›¸åŒçš„ï¼Œä¹Ÿæ˜¯é™å®šæŒ‡å®šçš„çº¿ç¨‹æ•°é‡èƒ½å¤ŸåŒæ—¶è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œä½†æ˜¯å®ƒç›¸å¯¹äºçº¿ç¨‹æ± éš”ç¦»ï¼Œå¼€é”€ä¼šæ›´å°ä¸€äº›ï¼Œä½¿ç”¨æ•ˆæœåŒæ ·ä¼˜ç§€ï¼Œä¹Ÿæ”¯æŒè¶…æ—¶ç­‰ã€‚</p><p>Sentinelä¹Ÿæ­£æ˜¯é‡‡ç”¨çš„è¿™ç§æ–¹æ¡ˆå®ç°éš”ç¦»çš„ã€‚</p></li></ol><p>å¥½äº†ï¼Œè¯´å›æˆ‘ä»¬çš„ç†”æ–­å’Œé™çº§ï¼Œå½“ä¸‹æ¸¸æœåŠ¡å› ä¸ºæŸç§åŸå› å˜å¾—ä¸å¯ç”¨æˆ–å“åº”è¿‡æ…¢æ—¶ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿è¯è‡ªå·±æ•´ä½“æœåŠ¡çš„å¯ç”¨æ€§ï¼Œä¸å†ç»§ç»­è°ƒç”¨ç›®æ ‡æœåŠ¡è€Œæ˜¯å¿«é€Ÿè¿”å›æˆ–æ˜¯æ‰§è¡Œè‡ªå·±çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè¿™ä¾¿æ˜¯æœåŠ¡é™çº§ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/gY62LD3vw157WiU.png" alt="image-20230306232602853" tabindex="0" loading="lazy"><figcaption>image-20230306232602853</figcaption></figure><p>æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªçŠ¶æ€ï¼š</p><ul><li>å…³é—­ï¼šç†”æ–­å™¨ä¸å·¥ä½œï¼Œæ‰€æœ‰è¯·æ±‚å…¨éƒ¨è¯¥å¹²å˜›å¹²å˜›ã€‚</li><li>æ‰“å¼€ï¼šç†”æ–­å™¨å·¥ä½œï¼Œæ‰€æœ‰è¯·æ±‚ä¸€å¾‹é™çº§å¤„ç†ã€‚</li><li>åŠå¼€ï¼šå°è¯•è¿›è¡Œä¸€ä¸‹ä¸‹æ­£å¸¸æµç¨‹ï¼Œè¦æ˜¯è¿˜ä¸è¡Œç»§ç»­ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå¦åˆ™å…³é—­ã€‚</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹Sentinelä¸­å¦‚ä½•è¿›è¡Œç†”æ–­å’Œé™çº§æ“ä½œï¼Œæ‰“å¼€ç®¡ç†é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±æ–°å¢ç†”æ–­è§„åˆ™ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/7BW6LGXQNl5b1Iv.png" alt="image-20230306232618547" tabindex="0" loading="lazy"><figcaption>image-20230306232618547</figcaption></figure><p>å…¶ä¸­ï¼Œç†”æ–­ç­–ç•¥æœ‰ä¸‰ç§æ¨¡å¼ï¼š</p><ol><li><p><strong>æ…¢è°ƒç”¨æ¯”ä¾‹ï¼š</strong> å¦‚æœå‡ºç°é‚£ç§åŠå¤©éƒ½å¤„ç†ä¸å®Œçš„è°ƒç”¨ï¼Œæœ‰å¯èƒ½å°±æ˜¯æœåŠ¡å‡ºç°æ•…éšœï¼Œå¯¼è‡´å¡é¡¿ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯æŒ‰ç…§æœ€å¤§å“åº”æ—¶é—´ï¼ˆRTï¼‰è¿›è¡Œåˆ¤å®šï¼Œå¦‚æœä¸€æ¬¡è¯·æ±‚çš„å¤„ç†æ—¶é—´è¶…è¿‡äº†æŒ‡å®šçš„RTï¼Œé‚£ä¹ˆå°±è¢«åˆ¤å®šä¸º<code>æ…¢è°ƒç”¨</code>ï¼Œåœ¨ä¸€ä¸ªç»Ÿè®¡æ—¶é•¿å†…ï¼Œå¦‚æœè¯·æ±‚æ•°ç›®å¤§äºæœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”è¢«åˆ¤å®šä¸º<code>æ…¢è°ƒç”¨</code>çš„è¯·æ±‚æ¯”ä¾‹å·²ç»è¶…è¿‡é˜ˆå€¼ï¼Œå°†è§¦å‘ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿ä¹‹åï¼Œå°†ä¼šè¿›å…¥åˆ°åŠå¼€çŠ¶æ€è¿›è¡Œè¯•æ¢ï¼ˆè¿™é‡Œå’ŒHystrixä¸€è‡´ï¼‰</p><p>ç„¶åä¿®æ”¹ä¸€ä¸‹æ¥å£çš„æ‰§è¡Œï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹æ…¢è°ƒç”¨ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/borrow2/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findUserBorrows2</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> uid) throws InterruptedException {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯ï¼Œç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç†”æ–­è§„åˆ™ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/ExWIKFSNpPoksiT.png" alt="image-20230306232632385" tabindex="0" loading="lazy"><figcaption>image-20230306232632385</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¶…æ—¶ç›´æ¥è§¦å‘äº†ç†”æ–­ï¼Œè¿›å…¥åˆ°é˜»æ­¢é¡µé¢ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/CmdPgcqvX4a2u9p.png" alt="image-20230306232642387" tabindex="0" loading="lazy"><figcaption>image-20230306232642387</figcaption></figure></li><li><p><strong>å¼‚å¸¸æ¯”ä¾‹ï¼š</strong> è¿™ä¸ªä¸æ…¢è°ƒç”¨æ¯”ä¾‹ç±»ä¼¼ï¼Œä¸è¿‡è¿™é‡Œåˆ¤æ–­çš„æ˜¯å‡ºç°å¼‚å¸¸çš„æ¬¡æ•°ï¼Œä¸ä¸Šé¢ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿæ¥è¿›è¡Œä¸€äº›å°æµ‹è¯•ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/borrow2/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findUserBorrows2</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> uid) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨æœåŠ¡å™¨ï¼Œæ¥ç€æ·»åŠ æˆ‘ä»¬çš„ç†”æ–­è§„åˆ™ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/Dz3EgG9eH4UXTkJ.png" alt="image-20230306232652092" tabindex="0" loading="lazy"><figcaption>image-20230306232652092</figcaption></figure><p>ç°åœ¨æˆ‘ä»¬è¿›è¡Œè®¿é—®ï¼Œä¼šå‘ç°åå°ç–¯ç‹‚æŠ¥é”™ï¼Œç„¶åå°±ç†”æ–­äº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/jSp92ODTRhlxJsn.png" alt="image-20230306232702794" tabindex="0" loading="lazy"><figcaption>image-20230306232702794</figcaption></figure><figure><img src="https://s2.loli.net/2023/03/06/FfhalnZdS2ujm1t.png" alt="image-20230306232711467" tabindex="0" loading="lazy"><figcaption>image-20230306232711467</figcaption></figure></li><li><p><strong>å¼‚å¸¸æ•°ï¼š</strong> è¿™ä¸ªå’Œä¸Šé¢çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œåªè¦è¾¾åˆ°æŒ‡å®šçš„å¼‚å¸¸æ•°é‡ï¼Œå°±ç†”æ–­ï¼Œè¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ç†”æ–­è§„åˆ™ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/CugOUozGA6inB3R.png" alt="image-20230306232720801" tabindex="0" loading="lazy"><figcaption>image-20230306232720801</figcaption></figure><p>ç°åœ¨æˆ‘ä»¬å†æ¬¡ä¸æ–­è®¿é—®æ­¤æ¥å£ï¼Œå¯ä»¥å‘ç°ï¼Œæ•ˆæœè·Ÿä¹‹å‰å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯åˆ¤æ–­çš„ç­–ç•¥ç¨å¾®ä¸åŒç½¢äº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/XC1VekDfainIpv6.png" alt="image-20230306232738961" tabindex="0" loading="lazy"><figcaption>image-20230306232738961</figcaption></figure></li></ol><p>é‚£ä¹ˆç†”æ–­è§„åˆ™å¦‚ä½•è®¾å®šæˆ‘ä»¬äº†è§£äº†ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•è‡ªå®šä¹‰æœåŠ¡é™çº§å‘¢ï¼Ÿä¹‹å‰åœ¨ä½¿ç”¨Hystrixçš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œå¯ä»¥æ‰§è¡Œæˆ‘ä»¬çš„æ›¿ä»£æ–¹æ¡ˆï¼ŒSentinelä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<code>@SentinelResource</code>ä¸­é…ç½®<code>blockHandler</code>å‚æ•°ï¼ˆé‚£è¿™é‡Œè·Ÿå‰é¢é‚£ä¸ªæ–¹æ³•é™æµçš„é…ç½®ä¸æ˜¯ä¸€æ¯›ä¸€æ ·å—ï¼Ÿæ²¡é”™ï¼Œå› ä¸ºå¦‚æœæ·»åŠ äº†<code>@SentinelResource</code>æ³¨è§£ï¼Œé‚£ä¹ˆè¿™é‡Œä¼šè¿›è¡Œæ–¹æ³•çº§åˆ«ç»†ç²’åº¦çš„é™åˆ¶ï¼Œå’Œä¹‹å‰æ–¹æ³•çº§åˆ«é™æµä¸€æ ·ï¼Œä¼šåœ¨é™çº§ä¹‹åç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœä¸æ·»åŠ åˆ™è¿”å›é»˜è®¤çš„é™æµé¡µé¢ï¼Œ<code>blockHandler</code>çš„ç›®çš„å°±æ˜¯å¤„ç†è¿™ç§Sentinelæœºåˆ¶ä¸Šçš„å¼‚å¸¸ï¼Œæ‰€ä»¥è¿™é‡Œå…¶å®å’Œä¹‹å‰çš„é™æµé…ç½®æ˜¯ä¸€ä¸ªé“ç†ï¼Œå› æ­¤ä¸‹é¢ç†”æ–­é…ç½®ä¹Ÿåº”è¯¥å¯¹<code>value</code>è‡ªå®šä¹‰åç§°çš„èµ„æºè¿›è¡Œé…ç½®ï¼Œæ‰èƒ½ä½œç”¨åˆ°æ­¤æ–¹æ³•ä¸Šï¼‰ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/borrow2/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SentinelResource</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;findUserBorrows2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> blockHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findUserBorrows2</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> uid) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BlockException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> e){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserBorrowDetail</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Collections</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">emptyList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æˆ‘ä»¬å¯¹è¿›è¡Œç†”æ–­é…ç½®ï¼Œæ³¨æ„æ˜¯å¯¹æˆ‘ä»¬æ·»åŠ çš„<code>@SentinelResource</code>ä¸­æŒ‡å®šåç§°çš„<code>findUserBorrows2</code>è¿›è¡Œé…ç½®ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/QkofY5gzwSr6WGn.png" alt="image-20230306232759448" tabindex="0" loading="lazy"><figcaption>image-20230306232759448</figcaption></figure><p>OKï¼Œå¯ä»¥çœ‹åˆ°ç†”æ–­ä¹‹åï¼ŒæœåŠ¡é™çº§ä¹‹åçš„æ•ˆæœï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/5kLcAaT6wJgYXGx.png" alt="image-20230306232809712" tabindex="0" loading="lazy"><figcaption>image-20230306232809712</figcaption></figure><p>æœ€åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•è®©Feignçš„ä¹Ÿæ”¯æŒSentinelï¼Œå‰é¢æˆ‘ä»¬ä½¿ç”¨Hystrixçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥å¯¹Feignçš„æ¯ä¸ªæ¥å£è°ƒç”¨å•ç‹¬è¿›è¡ŒæœåŠ¡é™çº§ï¼Œè€Œä½¿ç”¨Sentinelï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯æ”¯æŒï¼š</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">feign</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  sentinel</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹‹åçš„æ­¥éª¤å…¶å®å’Œä¹‹å‰æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œé¦–å…ˆåˆ›å»ºå®ç°ç±»ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserClientFallback</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æˆ‘æ˜¯æ›¿ä»£æ–¹æ¡ˆ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> user;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åç›´æ¥å¯åŠ¨å°±å¯ä»¥äº†ï¼Œä¸­é€”çš„æ—¶å€™æˆ‘ä»¬å§ç”¨æˆ·æœåŠ¡å…¨éƒ¨ä¸‹æ‰ï¼Œå¯ä»¥çœ‹åˆ°æ­£å¸¸ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/M2yZpJLfs1i9adC.png" alt="image-20230306232821953" tabindex="0" loading="lazy"><figcaption>image-20230306232821953</figcaption></figure><p>è¿™æ ·Feignçš„é…ç½®å°±OKäº†ï¼Œé‚£ä¹ˆä¼ ç»Ÿçš„RestTemplateå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@SentinelRestTemplate</code>æ³¨è§£å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">LoadBalanced</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SentinelRestTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">blockHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;handleException&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> blockHandlerClass</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ExceptionUtil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      fallback</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;fallback&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> fallbackClass</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ExceptionUtil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//è¿™é‡ŒåŒæ ·å¯ä»¥è®¾å®šfallbackç­‰å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> RestTemplate</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> restTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RestTemplate</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå°±ä¸å¤šåšèµ˜è¿°äº†ã€‚</p><hr><figure><img src="https://s2.loli.net/2023/03/06/8OCeNap2Vy6X7WH.png" alt="image-20230306232833262" tabindex="0" loading="lazy"><figcaption>image-20230306232833262</figcaption></figure><h2 id="seataä¸åˆ†å¸ƒå¼äº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#seataä¸åˆ†å¸ƒå¼äº‹åŠ¡"><span>Seataä¸åˆ†å¸ƒå¼äº‹åŠ¡</span></a></h2><p>é‡éš¾ç‚¹å†…å®¹ï¼Œå‘ä¹Ÿå¤šå¾—ç¦»è°±ï¼Œæœ€å¥½ä¿æŒè·ŸUPä¸€æ ·çš„ç‰ˆæœ¬ï¼Œ<strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong> https://seata.io/zh-cn/docs/overview/what-is-seata.html</p><p>åœ¨å‰é¢çš„é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ è¿‡äº‹åŠ¡ï¼Œè¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„æ•°æ®åº“äº‹åŠ¡çš„ç‰¹æ€§å—ï¼Ÿ</p><ul><li><strong>åŸå­æ€§ï¼š</strong> ä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</li><li><strong>ä¸€è‡´æ€§ï¼š</strong> åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™ï¼Œè¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚</li><li><strong>éš”ç¦»æ€§ï¼š</strong> æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»å·²æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚</li><li><strong>æŒä¹…æ€§ï¼š</strong> äº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li></ul><p>é‚£ä¹ˆå„ä½è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œæœ‰å¯èƒ½å‡ºç°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸‹å•è´­ç‰©ï¼Œé‚£ä¹ˆæ•´ä¸ªæµç¨‹å¯èƒ½æ˜¯è¿™æ ·çš„ï¼šå…ˆè°ƒç”¨åº“å­˜æœåŠ¡å¯¹åº“å­˜è¿›è¡Œå‡æ‰£ -&gt; ç„¶åè®¢å•æœåŠ¡å¼€å§‹ä¸‹å• -&gt; æœ€åç”¨æˆ·è´¦æˆ·æœåŠ¡è¿›è¡Œæ‰£æ¬¾ï¼Œè™½ç„¶çœ‹ä¼¼æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ä¸€ä¸ªæµç¨‹ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰äº‹åŠ¡çš„åŠ æŒï¼Œå¾ˆæœ‰å¯èƒ½ä¼šç”±äºä¸­é€”å‡ºé”™ï¼Œæ¯”å¦‚æ•´ä¸ªæµç¨‹ä¸­è®¢å•æœåŠ¡å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åº“å­˜æ‰£äº†ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªè®¢å•å¹¶æ²¡æœ‰ç”Ÿæˆï¼Œç”¨æˆ·ä¹Ÿæ²¡æœ‰ä»˜æ¬¾ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/AiEXC3wBflPxHGT.png" alt="image-20230306233055869" tabindex="0" loading="lazy"><figcaption>image-20230306233055869</figcaption></figure><p>ä¸Šé¢è¿™ç§æƒ…å†µæ—¶é—´å°±æ˜¯ä¸€ç§å¤šæœåŠ¡å¤šæ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ï¼ˆæ¯”è¾ƒå¸¸è§ï¼‰ï¼Œå› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¾—å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè®©è¿™æ•´ä¸ªæµç¨‹ä¿è¯åŸå­æ€§ã€‚</p><p>SpringCloud Alibabaä¸ºæˆ‘ä»¬æä¾›äº†ç”¨äºå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ç»„ä»¶Seataã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/jDAy7osQ5YIqruP.png" alt="image-20230306233108567" tabindex="0" loading="lazy"><figcaption>image-20230306233108567</figcaption></figure><p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p><p>å®é™…ä¸Šï¼Œå°±æ˜¯å¤šäº†ä¸€ä¸ªä¸­é—´äººæ¥åè°ƒæ‰€æœ‰æœåŠ¡çš„äº‹åŠ¡ã€‚</p><h3 id="é¡¹ç›®ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#é¡¹ç›®ç¯å¢ƒæ­å»º"><span>é¡¹ç›®ç¯å¢ƒæ­å»º</span></a></h3><p>è¿™é‡Œæˆ‘ä»¬å¯¹æˆ‘ä»¬ä¹‹å‰çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿè¿›è¡Œå‡çº§ï¼š</p><ul><li>æ¯ä¸ªç”¨æˆ·æœ€å¤šåªèƒ½åŒæ—¶å€Ÿé˜…2æœ¬ä¸åŒçš„ä¹¦ã€‚</li><li>å›¾ä¹¦é¦†ä¸­æ‰€æœ‰çš„ä¹¦éƒ½æœ‰3æœ¬ã€‚</li><li>ç”¨æˆ·å€Ÿä¹¦æµç¨‹ï¼šå…ˆè°ƒç”¨å›¾ä¹¦æœåŠ¡ä¹¦ç±æ•°é‡-1 -&gt; æ·»åŠ å€Ÿé˜…è®°å½• -&gt; è°ƒç”¨ç”¨æˆ·æœåŠ¡ç”¨æˆ·å¯å€Ÿé˜…æ•°é‡-1</li></ul><p>é‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œä¸ºäº†ç®€ä¾¿ï¼Œå°±ç›´æ¥åœ¨ç”¨æˆ·è¡¨ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µç”¨äºå­˜å‚¨ç”¨æˆ·èƒ½å¤Ÿå€Ÿé˜…çš„ä¹¦ç±æ•°é‡ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/TvJL2PiWFU4XoaZ.png" alt="image-20230306232857302" tabindex="0" loading="lazy"><figcaption>image-20230306232857302</figcaption></figure><p>ç„¶åä¿®æ”¹ä¹¦ç±ä¿¡æ¯ï¼Œä¹Ÿæ˜¯ç›´æ¥æ·»åŠ ä¸€ä¸ªå­—æ®µç”¨äºè®°å½•å‰©ä½™æ•°é‡ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/WjEcGbtkNrZi1CL.png" alt="image-20230306232904202" tabindex="0" loading="lazy"><figcaption>image-20230306232904202</figcaption></figure><p>æ¥ç€æˆ‘ä»¬å»ç¼–å†™ä¸€ä¸‹å¯¹åº”çš„æœåŠ¡å§ï¼Œé¦–å…ˆæ˜¯ç”¨æˆ·æœåŠ¡ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Mapper</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Select</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;select * from DB_USER where uid = #{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Select</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;select book_count from DB_USER where uid = #{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserBookRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Update</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;update DB_USER set book_count = #{count} where uid = #{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> updateBookCount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Service</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserServiceImpl</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    UserMapper</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserBookRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> setRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">updateBookCount</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid, count) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    UserService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/remain/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> userRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/borrow/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> userBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> remain</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid, remain </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæ˜¯å›¾ä¹¦æœåŠ¡ï¼Œå…¶å®è·Ÿç”¨æˆ·æœåŠ¡å·®ä¸å¤šï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Mapper</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BookMapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Select</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;select * from DB_BOOK where bid = #{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Book</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Select</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;select count from DB_BOOK  where bid = #{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Update</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;update DB_BOOK set count = #{count}  where bid = #{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> setRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Service</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BookServiceImpl</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BookService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BookMapper</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Book</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> setRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bid, count) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BookController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BookService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/book/{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Book</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/book/remain/{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> bookRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/book/borrow/{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> bookBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> remain</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid, remain </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åå®Œå–„æˆ‘ä»¬çš„å€Ÿé˜…æœåŠ¡ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">FeignClient</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;userservice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    User</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/borrow/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> userBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/user/remain/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> userRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">FeignClient</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bookservice&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/book/{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Book</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/book/borrow/{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> bookBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/book/remain/{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> bookRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BorrowController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BorrowService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/borrow/{uid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> findUserBorrows</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserBorrowDetailByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/borrow/take/{uid}/{bid}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    JSONObject</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> borrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;uid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                      @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;bid&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">doBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid, bid);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        JSONObject</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> object</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> JSONObject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        object</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;code&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;200&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        object</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;success&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        object</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;å€Ÿé˜…æˆåŠŸï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> object;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Service</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BorrowServiceImpl</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BorrowService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BorrowMapper</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    UserClient</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    BookClient</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserBorrowDetail</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUserBorrowDetailByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Borrow</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">borrow</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBorrowsByUid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        User</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUserById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Book</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bookList</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> borrow</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">stream</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(b </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBookById</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">collect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Collectors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">toList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UserBorrowDetail</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(user, bookList);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> bid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      	//1. åˆ¤æ–­å›¾ä¹¦å’Œç”¨æˆ·æ˜¯å¦éƒ½æ”¯æŒå€Ÿé˜…</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bookRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bid) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;å›¾ä¹¦æ•°é‡ä¸è¶³&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">userRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ç”¨æˆ·å€Ÿé˜…é‡ä¸è¶³&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      	//2. é¦–å…ˆå°†å›¾ä¹¦çš„æ•°é‡-1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bookBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bid))</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;åœ¨å€Ÿé˜…å›¾ä¹¦æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      	//3. æ·»åŠ å€Ÿé˜…ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid, bid) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æ­¤ä¹¦ç±å·²ç»è¢«æ­¤ç”¨æˆ·å€Ÿé˜…äº†ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid, bid) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;åœ¨å½•å…¥å€Ÿé˜…ä¿¡æ¯æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      	//4. ç”¨æˆ·å¯å€Ÿé˜…-1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">userBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid))</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;åœ¨å€Ÿé˜…æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      	//å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œåªè¦æˆ‘ä»¬çš„å›¾ä¹¦å€Ÿé˜…è¿‡ç¨‹ä¸­ä»»ä½•ä¸€æ­¥å‡ºç°é—®é¢˜ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/MPkZb1dA2Khjcty.png" alt="image-20230306233138135" tabindex="0" loading="lazy"><figcaption>image-20230306233138135</figcaption></figure><p>å†æ¬¡å°è¯•å€Ÿé˜…ï¼Œåå°ä¼šç›´æ¥æŠ¥é”™ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/H43Fy9z76LIvJGd.png" alt="image-20230306233147990" tabindex="0" loading="lazy"><figcaption>image-20230306233147990</figcaption></figure><p>æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå€Ÿé˜…ä¿¡æ¯æ·»åŠ å¤±è´¥äº†ï¼Œä½†æ˜¯å›¾ä¹¦çš„æ•°é‡ä¾ç„¶è¢«-1ï¼Œä¹Ÿå°±æ˜¯è¯´æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›ä¸­é€”å‡ºç°å¼‚å¸¸ä¹‹åï¼Œä¹‹å‰çš„æ“ä½œå…¨éƒ¨å›æ»šçš„ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/l9D8aXBxkvnZejw.png" alt="image-20230306233201664" tabindex="0" loading="lazy"><figcaption>image-20230306233201664</figcaption></figure><p>è€Œè¿™é‡Œç”±äºæ˜¯åœ¨å¦ä¸€ä¸ªæœåŠ¡ä¸­è¿›è¡Œçš„æ•°æ®åº“æ“ä½œï¼Œæ‰€ä»¥ä¼ ç»Ÿçš„<code>@Transactional</code>æ³¨è§£æ— æ•ˆï¼Œè¿™æ—¶å°±å¾—å€ŸåŠ©Seataæä¾›åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚</p><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"><span>åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</span></a></h3><p>è¦å¼€å§‹å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæˆ‘ä»¬å¾—å…ˆä»ç†è®ºä¸Šå¼€å§‹ä¸‹æ‰‹ï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹å¸¸ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p><ol><li><p><strong>XAåˆ†å¸ƒå¼äº‹åŠ¡åè®® - 2PCï¼ˆä¸¤é˜¶æ®µæäº¤å®ç°ï¼‰</strong></p><p>è¿™é‡Œçš„PCå®é™…ä¸ŠæŒ‡çš„æ˜¯Prepareå’ŒCommitï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯å‡†å¤‡ä¸€ä¸ªæ˜¯æäº¤ï¼Œæ•´ä¸ªè¿‡ç¨‹çš„å‚ä¸è€…ä¸€å…±æœ‰ä¸¤ä¸ªè§’è‰²ï¼Œä¸€ä¸ªæ˜¯äº‹åŠ¡çš„æ‰§è¡Œè€…ï¼Œä¸€ä¸ªæ˜¯äº‹åŠ¡çš„åè°ƒè€…ï¼Œå®é™…ä¸Šæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„è¿ä½œéƒ½éœ€è¦ä¾é åè°ƒè€…æ¥ç»´æŒï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/BWiUzFrjHAao1kJ.png" alt="image-20230306233211675" tabindex="0" loading="lazy"><figcaption>image-20230306233211675</figcaption></figure><p>åœ¨å‡†å¤‡å’Œæäº¤é˜¶æ®µï¼Œä¼šè¿›è¡Œï¼š</p><ul><li><p><strong>å‡†å¤‡é˜¶æ®µï¼š</strong></p><p>ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ç”±åè°ƒè€…æ¥å¼€å¯çš„ï¼Œé¦–å…ˆåè°ƒè€…ä¼šå‘æ‰€æœ‰çš„äº‹åŠ¡æ‰§è¡Œè€…å‘é€äº‹åŠ¡å†…å®¹ï¼Œç­‰å¾…æ‰€æœ‰çš„äº‹åŠ¡æ‰§è¡Œè€…ç­”å¤ã€‚</p><p>å„ä¸ªäº‹åŠ¡æ‰§è¡Œè€…å¼€å§‹æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œä½†æ˜¯ä¸è¿›è¡Œæäº¤ï¼Œå¹¶å°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚</p><p>å¦‚æœäº‹åŠ¡æ‰§è¡Œè€…æ‰§è¡Œäº‹åŠ¡æˆåŠŸï¼Œé‚£ä¹ˆå°±å‘Šè¯‰åè°ƒè€…æˆåŠŸYesï¼Œå¦åˆ™å‘Šè¯‰åè°ƒè€…å¤±è´¥Noï¼Œä¸èƒ½æäº¤äº‹åŠ¡ã€‚</p></li><li><p><strong>æäº¤é˜¶æ®µï¼š</strong></p><p>å½“æ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½åé¦ˆå®Œæˆä¹‹åï¼Œè¿›å…¥ç¬¬äºŒé˜¶æ®µã€‚</p><p>åè°ƒè€…ä¼šæ£€æŸ¥å„ä¸ªæ‰§è¡Œè€…çš„åé¦ˆå†…å®¹ï¼Œå¦‚æœæ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½è¿”å›æˆåŠŸï¼Œé‚£ä¹ˆå°±å‘Šè¯‰æ‰€æœ‰çš„æ‰§è¡Œè€…å¯ä»¥æäº¤äº‹åŠ¡äº†ï¼Œæœ€åå†é‡Šæ”¾é”èµ„æºã€‚</p><p>å¦‚æœæœ‰è‡³å°‘ä¸€ä¸ªæ‰§è¡Œè€…è¿”å›å¤±è´¥æˆ–æ˜¯è¶…æ—¶ï¼Œé‚£ä¹ˆå°±è®©æ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½å›æ»šï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚</p></li></ul><p>è™½ç„¶è¿™ç§æ–¹å¼çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>äº‹åŠ¡åè°ƒè€…æ˜¯éå¸¸æ ¸å¿ƒçš„è§’è‰²ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œå°†å¯¼è‡´æ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚</li><li>å¦‚æœæäº¤é˜¶æ®µå‘ç”Ÿç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´æŸäº›äº‹åŠ¡æ‰§è¡Œè€…æ²¡æœ‰æ”¶åˆ°åè°ƒè€…å‘æ¥çš„æäº¤å‘½ä»¤ï¼Œå°†å¯¼è‡´æŸäº›æ‰§è¡Œè€…æäº¤æŸäº›æ‰§è¡Œè€…æ²¡æäº¤ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</li></ul></li><li><p><strong>XAåˆ†å¸ƒå¼äº‹åŠ¡åè®® - 3PCï¼ˆä¸‰é˜¶æ®µæäº¤å®ç°ï¼‰</strong></p><p>ä¸‰é˜¶æ®µæäº¤æ˜¯åœ¨äºŒé˜¶æ®µæäº¤åŸºç¡€ä¸Šçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œä¸»è¦æ˜¯åŠ å…¥äº†è¶…æ—¶æœºåˆ¶ï¼ŒåŒæ—¶åœ¨åè°ƒè€…å’Œæ‰§è¡Œè€…ä¸­éƒ½å¼•å…¥äº†è¶…æ—¶æœºåˆ¶ã€‚</p><p>ä¸‰ä¸ªé˜¶æ®µåˆ†åˆ«è¿›è¡Œï¼š</p><ul><li><p><strong>CanCommité˜¶æ®µï¼š</strong></p><p>åè°ƒè€…å‘æ‰§è¡Œè€…å‘é€CanCommitè¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œç„¶åå¼€å§‹ç­‰å¾…æ‰§è¡Œè€…çš„å“åº”ã€‚</p><p>æ‰§è¡Œè€…æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœå…¶è‡ªèº«è®¤ä¸ºå¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼Œåˆ™è¿”å›Yeså“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ï¼Œå¦åˆ™è¿”å›No</p></li><li><p><strong>PreCommité˜¶æ®µï¼š</strong></p><p>åè°ƒè€…æ ¹æ®æ‰§è¡Œè€…çš„ååº”æƒ…å†µæ¥å†³å®šæ˜¯å¦å¯ä»¥è¿›å…¥ç¬¬äºŒé˜¶æ®µäº‹åŠ¡çš„PreCommitæ“ä½œã€‚</p><p>å¦‚æœæ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½è¿”å›Yesï¼Œåˆ™åè°ƒè€…å‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€PreCommitè¯·æ±‚ï¼Œå¹¶è¿›å…¥Preparedé˜¶æ®µï¼Œæ‰§è¡Œè€…æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ï¼Œå¦‚æœæˆåŠŸæ‰§è¡Œï¼Œåˆ™è¿”å›æˆåŠŸå“åº”ã€‚</p><p>å¦‚æœæ‰€æœ‰çš„æ‰§è¡Œè€…è‡³å°‘æœ‰ä¸€ä¸ªè¿”å›Noï¼Œåˆ™åè°ƒè€…å‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€abortè¯·æ±‚ï¼Œæ‰€æœ‰çš„æ‰§è¡Œè€…åœ¨æ”¶åˆ°è¯·æ±‚æˆ–æ˜¯è¶…è¿‡ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°ä»»ä½•è¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥ä¸­æ–­äº‹åŠ¡ã€‚</p></li><li><p><strong>DoCommité˜¶æ®µï¼š</strong></p><p>è¯¥é˜¶æ®µè¿›è¡ŒçœŸæ­£çš„äº‹åŠ¡æäº¤ã€‚</p><p>åè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰æ‰§è¡Œè€…å‘é€çš„æˆåŠŸå“åº”ï¼Œé‚£ä¹ˆä»–å°†ä»PreCommitçŠ¶æ€è¿›å…¥åˆ°DoCommitçŠ¶æ€ï¼Œå¹¶å‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€doCommitè¯·æ±‚ï¼Œæ‰§è¡Œè€…æ¥æ”¶åˆ°doCommitè¯·æ±‚ä¹‹åï¼Œå¼€å§‹æ‰§è¡Œäº‹åŠ¡æäº¤ï¼Œå¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡èµ„æºï¼Œå¹¶æœ€åå‘åè°ƒè€…å‘é€ç¡®è®¤å“åº”ï¼Œåè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰æ‰§è¡Œè€…çš„ç¡®è®¤å“åº”ä¹‹åï¼Œå®Œæˆäº‹åŠ¡ï¼ˆå¦‚æœå› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´æ‰§è¡Œè€…æ²¡æœ‰æ”¶åˆ°doCommitè¯·æ±‚ï¼Œæ‰§è¡Œè€…ä¼šåœ¨è¶…æ—¶ä¹‹åç›´æ¥æäº¤äº‹åŠ¡ï¼Œè™½ç„¶æ‰§è¡Œè€…åªæ˜¯çŒœæµ‹åè°ƒè€…è¿”å›çš„æ˜¯doCommitè¯·æ±‚ï¼Œä½†æ˜¯å› ä¸ºå‰é¢çš„ä¸¤ä¸ªæµç¨‹éƒ½æ­£å¸¸æ‰§è¡Œï¼Œæ‰€ä»¥èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šè®¤ä¸ºæœ¬æ¬¡äº‹åŠ¡æ˜¯æˆåŠŸçš„ï¼Œå› æ­¤ä¼šç›´æ¥æäº¤ï¼‰</p><p>åè°ƒè€…æ²¡æœ‰æ¥æ”¶è‡³å°‘ä¸€ä¸ªæ‰§è¡Œè€…å‘é€çš„æˆåŠŸå“åº”ï¼ˆä¹Ÿå¯èƒ½æ˜¯å“åº”è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸­æ–­äº‹åŠ¡ï¼Œåè°ƒè€…ä¼šå‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€abortè¯·æ±‚ï¼Œæ‰§è¡Œè€…æ¥æ”¶åˆ°abortè¯·æ±‚ä¹‹åï¼Œåˆ©ç”¨å…¶åœ¨PreCommité˜¶æ®µè®°å½•çš„undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›æ»šä¹‹åé‡Šæ”¾æ‰€æœ‰çš„äº‹åŠ¡èµ„æºï¼Œæ‰§è¡Œè€…å®Œæˆäº‹åŠ¡å›æ»šä¹‹åï¼Œå‘åè°ƒè€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œ åè°ƒè€…æ¥æ”¶åˆ°å‚ä¸è€…åé¦ˆçš„ç¡®è®¤æ¶ˆæ¯ä¹‹åï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚</p></li></ul><p>ç›¸æ¯”ä¸¤é˜¶æ®µæäº¤ï¼Œä¸‰é˜¶æ®µæäº¤çš„ä¼˜åŠ¿æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ï¼š</p><ul><li>3PCåœ¨2PCçš„ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µä¸­æ’å…¥ä¸€ä¸ªå‡†å¤‡é˜¶æ®µï¼Œä¿è¯äº†åœ¨æœ€åæäº¤é˜¶æ®µä¹‹å‰å„å‚ä¸èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚</li><li>ä¸€æ—¦å‚ä¸è€…æ— æ³•åŠæ—¶æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„ä¿¡æ¯ä¹‹åï¼Œä¼šé»˜è®¤æ‰§è¡ŒCommitï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºåè°ƒè€…å•æ–¹é¢çš„æ•…éšœå¯¼è‡´å…¨å±€å‡ºç°é—®é¢˜ã€‚</li><li>ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå®é™…ä¸Šè¶…æ—¶ä¹‹åçš„Commitå†³ç­–æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªèµŒæ³¨ç½¢äº†ï¼Œå¦‚æœæ­¤æ—¶åè°ƒè€…å‘é€çš„æ˜¯abortè¯·æ±‚ä½†æ˜¯è¶…æ—¶æœªæ¥æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥å¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li></ul></li><li><p><strong>TCCï¼ˆè¡¥å¿äº‹åŠ¡ï¼‰</strong></p><p>è¡¥å¿äº‹åŠ¡TCCå°±æ˜¯Tryã€Confirmã€Cancelï¼Œå®ƒå¯¹ä¸šåŠ¡æœ‰ä¾µå…¥æ€§ï¼Œä¸€å…±åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¾æ¬¡æ¥è§£è¯»ä¸€ä¸‹ã€‚</p><ul><li><p><strong>Tryé˜¶æ®µï¼š</strong></p><p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨å€Ÿä¹¦æ—¶ï¼Œå°†ä¹¦ç±çš„åº“å­˜<code>-1</code>ï¼Œå¹¶ä¸”ç”¨æˆ·çš„å€Ÿé˜…é‡ä¹Ÿ<code>-1</code>ï¼Œä½†æ˜¯è¿™ä¸ªæ“ä½œï¼Œé™¤äº†ç›´æ¥å¯¹åº“å­˜å’Œå€Ÿé˜…é‡è¿›è¡Œä¿®æ”¹ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°†å‡å»çš„å€¼ï¼Œå•ç‹¬å­˜æ”¾åˆ°å†»ç»“è¡¨ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶ä¸ä¼šåˆ›å»ºå€Ÿé˜…ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åªæ˜¯é¢„å…ˆæŠŠå…³é”®çš„ä¸œè¥¿ç»™å¤„ç†äº†ï¼Œé¢„ç•™ä¸šåŠ¡èµ„æºå‡ºæ¥ã€‚</p></li><li><p><strong>Confirmé˜¶æ®µï¼š</strong></p><p>å¦‚æœTryæ‰§è¡ŒæˆåŠŸæ— è¯¯ï¼Œé‚£ä¹ˆå°±è¿›å…¥åˆ°Confirmé˜¶æ®µï¼Œæ¥ç€ä¹‹å‰ï¼Œæˆ‘ä»¬å°±è¯¥åˆ›å»ºå€Ÿé˜…ä¿¡æ¯äº†ï¼Œåªèƒ½ä½¿ç”¨Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼Œå¦‚æœåˆ›å»ºæˆåŠŸï¼Œé‚£ä¹ˆå°±å¯¹Tryé˜¶æ®µå†»ç»“çš„å€¼ï¼Œè¿›è¡Œè§£å†»ï¼Œæ•´ä¸ªæµç¨‹å°±å®Œæˆäº†ã€‚å½“ç„¶ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œé‚£ä¹ˆè¿›å…¥åˆ°Cancelé˜¶æ®µã€‚</p></li><li><p><strong>Cancelé˜¶æ®µï¼š</strong></p><p>ä¸ç”¨çŒœäº†ï¼Œé‚£è‚¯å®šæ˜¯æŠŠå†»ç»“çš„ä¸œè¥¿è¿˜ç»™äººå®¶ï¼Œå› ä¸ºæ•´ä¸ªå€Ÿé˜…æ“ä½œå‹æ ¹å°±æ²¡æˆåŠŸã€‚å°±åƒä½ ä»˜äº†æ¬¾ä¹°äº†ä¸œè¥¿ä½†æ˜¯ç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´äº¤æ˜“å¤±è´¥ï¼Œé’±ä¸å¯èƒ½ä¸è¿˜ç»™ä½ å§ã€‚</p></li></ul><p>è·ŸXAåè®®ç›¸æ¯”ï¼ŒTCCå°±æ²¡æœ‰åè°ƒè€…è¿™ä¸€è§’è‰²çš„å‚ä¸äº†ï¼Œè€Œæ˜¯è‡ªä¸»é€šè¿‡ä¸Šä¸€é˜¶æ®µçš„æ‰§è¡Œæƒ…å†µæ¥ç¡®ä¿æ­£å¸¸ï¼Œå……åˆ†åˆ©ç”¨äº†é›†ç¾¤çš„ä¼˜åŠ¿ï¼Œæ€§èƒ½ä¹Ÿæ˜¯æœ‰å¾ˆå¤§çš„æå‡ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå®ƒä¸ä¸šåŠ¡å…·æœ‰ä¸€å®šçš„å…³è”æ€§ï¼Œéœ€è¦å¼€å‘è€…å»ç¼–å†™æ›´å¤šçš„è¡¥å¿ä»£ç ï¼ŒåŒæ—¶å¹¶ä¸ä¸€å®šæ‰€æœ‰çš„ä¸šåŠ¡æµç¨‹éƒ½é€‚ç”¨äºè¿™ç§å½¢å¼ã€‚</p></li></ol><h3 id="seataæœºåˆ¶ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#seataæœºåˆ¶ç®€ä»‹"><span>Seataæœºåˆ¶ç®€ä»‹</span></a></h3><p>å‰é¢æˆ‘ä»¬äº†è§£äº†ä¸€äº›åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Seataæ˜¯å¦‚ä½•è¿›è¡Œåˆ†å¸ƒå¼äº‹åŠ¡çš„å¤„ç†çš„ã€‚</p><figure><img src="https://s2.loli.net/2023/03/06/LsUq3AvrfhQJPCz.png" alt="image-20230306233227905" tabindex="0" loading="lazy"><figcaption>image-20230306233227905</figcaption></figure><p>å®˜ç½‘ç»™å‡ºçš„æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ¶æ„å›¾ï¼Œé‚£ä¹ˆå›¾ä¸­çš„RMã€TMã€TCä»£è¡¨ç€ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><ul><li>RMï¼ˆResource Managerï¼‰ï¼šç”¨äºç›´æ¥æ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚</li><li>TMï¼ˆTransaction Managerï¼‰ï¼šTMæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æ ¸å¿ƒç®¡ç†è€…ã€‚æ¯”å¦‚ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨å€Ÿé˜…æœåŠ¡ä¸­å¼€å¯å…¨å±€äº‹åŠ¡ï¼Œæ¥è®©å…¶è‡ªèº«ã€å›¾ä¹¦æœåŠ¡ã€ç”¨æˆ·æœåŠ¡éƒ½å‚ä¸è¿›æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€èˆ¬å…¨å±€äº‹åŠ¡å‘èµ·è€…å°±æ˜¯TMã€‚</li><li>TCï¼ˆTransaction Managerï¼‰è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„SeataæœåŠ¡å™¨ï¼Œç”¨äºå…¨å±€æ§åˆ¶ï¼Œæ¯”å¦‚åœ¨XAæ¨¡å¼ä¸‹å°±æ˜¯ä¸€ä¸ªåè°ƒè€…çš„è§’è‰²ï¼Œè€Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„å¯åŠ¨å°±æ˜¯ç”±TMå‘TCå‘èµ·è¯·æ±‚ï¼ŒTCå†æ¥ä¸å…¶ä»–çš„RMè¿›è¡Œåè°ƒæ“ä½œã€‚</li></ul><blockquote><p>TMè¯·æ±‚TCå¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼ŒTCä¼šç”Ÿæˆä¸€ä¸ªXIDä½œä¸ºè¯¥å…¨å±€äº‹åŠ¡çš„ç¼–å·ï¼ŒXIDä¼šåœ¨å¾®æœåŠ¡çš„è°ƒç”¨é“¾è·¯ä¸­ä¼ æ’­ï¼Œä¿è¯å°†å¤šä¸ªå¾®æœåŠ¡çš„å­äº‹åŠ¡å…³è”åœ¨ä¸€èµ·ï¼›RMè¯·æ±‚TCå°†æœ¬åœ°äº‹åŠ¡æ³¨å†Œä¸ºå…¨å±€äº‹åŠ¡çš„åˆ†æ”¯äº‹åŠ¡ï¼Œé€šè¿‡å…¨å±€äº‹åŠ¡çš„XIDè¿›è¡Œå…³è”ï¼›TMè¯·æ±‚TCå‘Šè¯‰XIDå¯¹åº”çš„å…¨å±€äº‹åŠ¡æ˜¯è¿›è¡Œæäº¤è¿˜æ˜¯å›æ»šï¼›TCé©±åŠ¨RMå°†XIDå¯¹åº”çš„è‡ªå·±çš„æœ¬åœ°äº‹åŠ¡è¿›è¡Œæäº¤è¿˜æ˜¯å›æ»šï¼›</p></blockquote><p>Seataæ”¯æŒ4ç§äº‹åŠ¡æ¨¡å¼ï¼Œå®˜ç½‘æ–‡æ¡£ï¼šhttps://seata.io/zh-cn/docs/overview/what-is-seata.html</p><ul><li><p>ATï¼šæœ¬è´¨ä¸Šå°±æ˜¯2PCçš„å‡çº§ç‰ˆï¼Œåœ¨ AT æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·åªéœ€å…³å¿ƒè‡ªå·±çš„ â€œä¸šåŠ¡SQLâ€</p><ol><li>ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œé¦–å…ˆè§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡ SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œbefore imageâ€ï¼Œç„¶åæ‰§è¡Œâ€œä¸šåŠ¡ SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œå†å°†å…¶ä¿å­˜æˆâ€œafter imageâ€ï¼Œæœ€åç”Ÿæˆè¡Œé”ã€‚ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚</li><li>äºŒé˜¶æ®µå¦‚æœç¡®è®¤æäº¤çš„è¯ï¼Œå› ä¸ºâ€œä¸šåŠ¡ SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œ æ‰€ä»¥ Seata æ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ï¼Œå½“ç„¶å¦‚æœéœ€è¦å›æ»šï¼Œé‚£ä¹ˆå°±ç”¨â€œbefore imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œafter imageâ€ï¼Œå¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚</li></ol></li><li><p>TCCï¼šå’Œæˆ‘ä»¬ä¸Šé¢è®²è§£çš„æ€è·¯æ˜¯ä¸€æ ·çš„ã€‚</p></li><li><p>XAï¼šåŒä¸Šï¼Œä½†æ˜¯è¦æ±‚æ•°æ®åº“æœ¬èº«æ”¯æŒè¿™ç§æ¨¡å¼æ‰å¯ä»¥ã€‚</p></li><li><p>Sagaï¼šç”¨äºå¤„ç†é•¿äº‹åŠ¡ï¼Œæ¯ä¸ªæ‰§è¡Œè€…éœ€è¦å®ç°äº‹åŠ¡çš„æ­£å‘æ“ä½œå’Œè¡¥å¿æ“ä½œï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/vLTZFS4yn26uabA.png" alt="image-20230306233328901" tabindex="0" loading="lazy"><figcaption>image-20230306233328901</figcaption></figure></li></ul><p>é‚£ä¹ˆï¼Œä»¥ATæ¨¡å¼ä¸ºä¾‹ï¼Œæˆ‘ä»¬çš„ç¨‹åºå¦‚ä½•æ‰èƒ½åšåˆ°ä¸å¯¹ä¸šåŠ¡è¿›è¡Œä¾µå…¥çš„æƒ…å†µä¸‹å®ç°åˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Ÿå®é™…ä¸Šï¼ŒSeataå®¢æˆ·ç«¯ï¼Œæ˜¯é€šè¿‡å¯¹æ•°æ®æºè¿›è¡Œä»£ç†å®ç°çš„ï¼Œä½¿ç”¨çš„æ˜¯DataSourceProxyç±»ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿™è¾¹ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å¯¹åº”çš„ä»£ç†ç±»æ³¨å†Œä¸ºBeanå³å¯ï¼ˆ0.9ç‰ˆæœ¬ä¹‹åæ”¯æŒè‡ªåŠ¨è¿›è¡Œä»£ç†ï¼Œä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œï¼‰</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»¥ATæ¨¡å¼ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚</p><h3 id="ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²"><span>ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²</span></a></h3><p>Seataä¹Ÿæ˜¯ä»¥æœåŠ¡ç«¯å½¢å¼è¿›è¡Œéƒ¨ç½²çš„ï¼Œç„¶åæ¯ä¸ªæœåŠ¡éƒ½æ˜¯å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¸‹è½½åœ°å€ï¼šhttps://github.com/seata/seata/releases/download/v1.4.2/seata-server-1.4.2.zip</p><p>æŠŠæºç ä¹Ÿä¸‹è½½ä¸€ä¸‹ï¼šhttps://github.com/seata/seata/archive/refs/heads/develop.zip</p><p>ä¸‹è½½å®Œæˆä¹‹åï¼Œæ”¾å…¥åˆ°IDEAé¡¹ç›®ç›®å½•ä¸­ï¼Œæ·»åŠ å¯åŠ¨é…ç½®ï¼Œè¿™é‡Œç«¯å£ä½¿ç”¨8868ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/ykH1BSPcxlvY4on.png" alt="image-20230306233336803" tabindex="0" loading="lazy"><figcaption>image-20230306233336803</figcaption></figure><p>SeataæœåŠ¡ç«¯æ”¯æŒæœ¬åœ°éƒ¨ç½²æˆ–æ˜¯åŸºäºæ³¨å†Œå‘ç°ä¸­å¿ƒéƒ¨ç½²ï¼ˆæ¯”å¦‚Nacosã€Eurekaç­‰ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬é¦–å…ˆæ¼”ç¤ºä¸€ä¸‹æœ€ç®€å•çš„æœ¬åœ°éƒ¨ç½²ï¼Œä¸éœ€è¦å¯¹Seataçš„é…ç½®æ–‡ä»¶åšä»»ä½•ä¿®æ”¹ã€‚</p><p>Seataå­˜åœ¨ç€äº‹åŠ¡åˆ†ç»„æœºåˆ¶ï¼š</p><ul><li>äº‹åŠ¡åˆ†ç»„ï¼šseataçš„èµ„æºé€»è¾‘ï¼Œå¯ä»¥æŒ‰å¾®æœåŠ¡çš„éœ€è¦ï¼Œåœ¨åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰å¯¹è‡ªè¡Œå®šä¹‰äº‹åŠ¡åˆ†ç»„ï¼Œæ¯ç»„å–ä¸€ä¸ªåå­—ã€‚</li><li>é›†ç¾¤ï¼šseata-serveræœåŠ¡ç«¯ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤clusterã€‚ åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ä½¿ç”¨æ—¶éœ€è¦æŒ‡å®šäº‹åŠ¡é€»è¾‘åˆ†ç»„ä¸SeataæœåŠ¡ç«¯é›†ç¾¤ï¼ˆé»˜è®¤ä¸ºdefaultï¼‰çš„æ˜ å°„å…³ç³»ã€‚</li></ul><p>ä¸ºå•¥è¦è®¾è®¡æˆé€šè¿‡äº‹åŠ¡åˆ†ç»„å†ç›´æ¥æ˜ å°„åˆ°é›†ç¾¤ï¼Ÿå¹²å˜›ä¸ç›´æ¥æŒ‡å®šé›†ç¾¤å‘¢ï¼Ÿè·å–äº‹åŠ¡åˆ†ç»„åˆ°æ˜ å°„é›†ç¾¤çš„é…ç½®ã€‚è¿™æ ·è®¾è®¡åï¼Œäº‹åŠ¡åˆ†ç»„å¯ä»¥ä½œä¸ºèµ„æºçš„é€»è¾‘éš”ç¦»å•ä½ï¼Œå‡ºç°æŸé›†ç¾¤æ•…éšœæ—¶å¯ä»¥å¿«é€Ÿfailoverï¼Œåªåˆ‡æ¢å¯¹åº”åˆ†ç»„ï¼Œå¯ä»¥æŠŠæ•…éšœç¼©å‡åˆ°æœåŠ¡çº§åˆ«ï¼Œä½†å‰æä¹Ÿæ˜¯ä½ æœ‰è¶³å¤Ÿserveré›†ç¾¤ã€‚</p><p>æ¥ç€æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„å„ä¸ªæœåŠ¡ä½œä¸ºSeateçš„å®¢æˆ·ç«¯ï¼Œåªéœ€è¦å¯¼å…¥ä¾èµ–å³å¯ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;com.alibaba.cloud&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-cloud-starter-alibaba-seata&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæ·»åŠ é…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    vgroup-mapping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    	# è¿™é‡Œéœ€è¦å¯¹äº‹åŠ¡ç»„åšæ˜ å°„ï¼Œé»˜è®¤çš„åˆ†ç»„åä¸º åº”ç”¨åç§°-seata-service-groupï¼Œå°†å…¶æ˜ å°„åˆ°defaulté›†ç¾¤</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    	# è¿™ä¸ªå¾ˆå…³é”®ï¼Œä¸€å®šè¦é…ç½®å¯¹ï¼Œä¸ç„¶ä¼šæ‰¾ä¸åˆ°æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      bookservice-seata-service-group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">default</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    grouplist</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">localhost:8868</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·å°±å¯ä»¥ç›´æ¥å¯åŠ¨äº†ï¼Œä½†æ˜¯æ³¨æ„ç°åœ¨åªæ˜¯å•çº¯åœ°è¿æ¥ä¸Šï¼Œå¹¶æ²¡æœ‰å¼€å¯ä»»ä½•çš„åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥ç€æ¥é…ç½®å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé¦–å…ˆåœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼Œæ­¤æ³¨è§£ä¼šæ·»åŠ ä¸€ä¸ªåç½®å¤„ç†å™¨å°†æ•°æ®æºå°è£…ä¸ºæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„ä»£ç†æ•°æ®æºï¼ˆè™½ç„¶å®˜æ–¹è¡¨ç¤ºé…ç½®æ–‡ä»¶ä¸­å·²ç»é»˜è®¤å¼€å¯äº†è‡ªåŠ¨ä»£ç†ï¼Œä½†æ˜¯UPä¸»å®æµ‹1.4.2ç‰ˆæœ¬ä¸‹åªèƒ½æ‰“æ³¨è§£çš„æ–¹å¼æ‰èƒ½ç”Ÿæ•ˆï¼‰ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">EnableAutoDataSourceProxy</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SpringBootApplication</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> BookApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        SpringApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">BookApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, args);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ³•ä¸Šæ·»åŠ <code>@GlobalTransactional</code>æ³¨è§£ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">GlobalTransactional</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> uid</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> bid) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  	//è¿™é‡Œæ‰“å°ä¸€ä¸‹XIDçœ‹çœ‹ï¼Œå…¶ä»–çš„æœåŠ¡ä¸šæ·»åŠ è¿™æ ·ä¸€ä¸ªæ‰“å°ï¼Œå¦‚æœä¸€ä¼šéƒ½æ‰“å°çš„æ˜¯åŒä¸€ä¸ªXIDï¼Œè¡¨ç¤ºä½¿ç”¨çš„å°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">RootContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getXID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bookRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bid)</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;å›¾ä¹¦æ•°é‡ä¸è¶³&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">userRemain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid)</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ç”¨æˆ·å€Ÿé˜…é‡ä¸è¶³&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">bookClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bookBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(bid)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;åœ¨å€Ÿé˜…å›¾ä¹¦æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid, bid)</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æ­¤ä¹¦ç±å·²ç»è¢«æ­¤ç”¨æˆ·å€Ÿé˜…äº†ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">mapper</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid, bid)</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;åœ¨å½•å…¥å€Ÿé˜…ä¿¡æ¯æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">userBorrow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(uid)</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;åœ¨å€Ÿé˜…æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿˜æ²¡ç»“æŸï¼Œæˆ‘ä»¬å‰é¢è¯´äº†ï¼ŒSeataä¼šåˆ†æä¿®æ”¹æ•°æ®çš„sqlï¼ŒåŒæ—¶ç”Ÿæˆå¯¹åº”çš„åå‘å›æ»šSQLï¼Œè¿™ä¸ªå›æ»šè®°å½•ä¼šå­˜æ”¾åœ¨undo_log è¡¨ä¸­ã€‚æ‰€ä»¥è¦æ±‚æ¯ä¸€ä¸ªClient éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„undo_logè¡¨ï¼ˆä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªæœåŠ¡è¿æ¥çš„æ•°æ®åº“éƒ½éœ€è¦åˆ›å»ºè¿™æ ·ä¸€ä¸ªè¡¨ï¼Œè¿™é‡Œç”±äºæˆ‘ä»¬ä¸‰ä¸ªæœåŠ¡éƒ½ç”¨çš„åŒä¸€ä¸ªæ•°æ®åº“ï¼Œæ‰€ä»¥è¯´å°±åªç”¨åœ¨è¿™ä¸ªæ•°æ®åº“ä¸­åˆ›å»ºundo_logè¡¨å³å¯ï¼‰ï¼Œè¡¨SQLå®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> `</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">undo_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">`</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  `id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            BIGINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)   </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  `branch_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     BIGINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)   </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  `xid`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">           VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  `context`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  `rollback_info`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> LONGBLOB     </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  `log_status`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    INT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">11</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)      </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  `log_created`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   DATETIME</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  `log_modified`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  DATETIME</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  `ext`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">           VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`id`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  UNIQUE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> KEY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `ux_undo_log`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`xid`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`branch_id`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  AUTO_INCREMENT </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> utf8;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥å¯åŠ¨ä¸‰ä¸ªæœåŠ¡äº†ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹å½“å‡ºç°å¼‚å¸¸çš„æ—¶å€™æ˜¯ä¸æ˜¯ä¼šæ­£å¸¸å›æ»šï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/NIe9QFW3jf1DdnV.png" alt="image-20230306233351571" tabindex="0" loading="lazy"><figcaption>image-20230306233351571</figcaption></figure><figure><img src="https://s2.loli.net/2023/03/06/LwcdO2HuWAhFr5p.png" alt="image-20230306233359914" tabindex="0" loading="lazy"><figcaption>image-20230306233359914</figcaption></figure><p>é¦–å…ˆç¬¬ä¸€æ¬¡è‚¯å®šæ˜¯æ­£å¸¸å®Œæˆå€Ÿé˜…æ“ä½œçš„ï¼Œæ¥ç€æˆ‘ä»¬å†æ¬¡è¿›è¡Œè¯·æ±‚ï¼Œè‚¯å®šä¼šå‡ºç°å¼‚å¸¸ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/6VOfsp9UxYJzgKD.png" alt="image-20230306233408870" tabindex="0" loading="lazy"><figcaption>image-20230306233408870</figcaption></figure><figure><img src="https://s2.loli.net/2023/03/06/yEQa2qeiNc5npV9.png" alt="image-20230306233417576" tabindex="0" loading="lazy"><figcaption>image-20230306233417576</figcaption></figure><p>å¦‚æœèƒ½åœ¨æ ˆè¿½è¸ªä¿¡æ¯ä¸­çœ‹åˆ°seataç›¸å…³çš„åŒ…ï¼Œé‚£ä¹ˆè¯´æ˜åˆ†å¸ƒå¼äº‹åŠ¡å·²ç»å¼€å§‹å·¥ä½œäº†ï¼Œé€šè¿‡æ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‡ºç°äº†å›æ»šæ“ä½œï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/VtBlx4U1TzcqKra.png" alt="image-20230306233428386" tabindex="0" loading="lazy"><figcaption>image-20230306233428386</figcaption></figure><p>å¹¶ä¸”æ•°æ®åº“ä¸­ç¡®å®æ˜¯å›æ»šäº†æ‰£é™¤æ“ä½œï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/WXn9UPgxBVhdHmb.png" alt="image-20230306233436382" tabindex="0" loading="lazy"><figcaption>image-20230306233436382</figcaption></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡Seataç®€å•åœ°å®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><h3 id="ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²"><span>ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²</span></a></h3><p>å‰é¢æˆ‘ä»¬å®ç°äº†æœ¬åœ°SeataæœåŠ¡çš„fileæ¨¡å¼éƒ¨ç½²ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è®©å…¶é…åˆNacosè¿›è¡Œéƒ¨ç½²ï¼Œåˆ©ç”¨Nacosçš„é…ç½®ç®¡ç†å’ŒæœåŠ¡å‘ç°æœºåˆ¶ï¼ŒSeataèƒ½å¤Ÿæ›´å¥½åœ°å·¥ä½œã€‚</p><p>æˆ‘ä»¬å…ˆå•ç‹¬ä¸ºSeataé…ç½®ä¸€ä¸ªå‘½åç©ºé—´ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/93mXN5dlC2GTLOW.png" alt="image-20230306233444767" tabindex="0" loading="lazy"><figcaption>image-20230306233444767</figcaption></figure><p>æˆ‘ä»¬æ‰“å¼€<code>conf</code>ç›®å½•ä¸­çš„<code>registry.conf</code>é…ç½®æ–‡ä»¶ï¼š</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">registry {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	# æ³¨å†Œé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	# å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯ä»¥é€‰æ‹©ç±»å‹ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ™®é€šçš„fileç±»å‹ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°æ–‡ä»¶çš„å½¢å¼è¿›è¡Œæ³¨å†Œé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	# æ”¯æŒçš„ç±»å‹å¦‚ä¸‹ï¼Œå¯¹åº”çš„ç±»å‹åœ¨ä¸‹é¢éƒ½æœ‰å¯¹åº”çš„é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	# é‡‡ç”¨nacosæ–¹å¼ä¼šå°†seataæœåŠ¡ç«¯ä¹Ÿæ³¨å†Œåˆ°nacosä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥åˆ©ç”¨æœåŠ¡å‘ç°è‡ªåŠ¨æ‰¾åˆ°seataæœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	# å°±ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šIPå’Œç«¯å£äº†ï¼Œä¸è¿‡çœ‹ä¼¼æ–¹ä¾¿ï¼Œå‘å€’æ˜¯ä¸å°‘ï¼Œåé¢å†è¯´</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  nacos {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  	# åº”ç”¨åç§°ï¼Œè¿™é‡Œé»˜è®¤å°±è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;seata-server&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # NacosæœåŠ¡å™¨åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    serverAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;localhost:8848&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # è¿™é‡Œä½¿ç”¨çš„æ˜¯SEATA_GROUPç»„ï¼Œä¸€ä¼šæ³¨å†Œåˆ°Nacosä¸­å°±æ˜¯è¿™ä¸ªç»„</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;SEATA_GROUP&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # è¿™é‡Œå°±ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢å•ç‹¬ä¸ºseataé…ç½®çš„å‘½åç©ºé—´ï¼Œæ³¨æ„å¡«çš„æ˜¯ID</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;89fc2145-4676-48b8-9edd-29e867879bcb&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # é›†ç¾¤åç§°ï¼Œè¿™é‡Œè¿˜æ˜¯ä½¿ç”¨default</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    cluster</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;default&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # Nacosçš„ç”¨æˆ·åå’Œå¯†ç </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  }</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  	#...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨å†Œä¿¡æ¯é…ç½®å®Œæˆä¹‹åï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å°†é…ç½®æ–‡ä»¶ä¹Ÿæ”¾åˆ°Nacosä¸­ï¼Œè®©Nacosç®¡ç†é…ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹é…ç½®è¿›è¡Œçƒ­æ›´æ–°äº†ï¼Œä¸€æ—¦ç¯å¢ƒéœ€è¦å˜åŒ–ï¼Œåªéœ€è¦ç›´æ¥åœ¨Nacosä¸­ä¿®æ”¹å³å¯ã€‚</p><div class="language-properties line-numbers-mode" data-highlighter="shiki" data-ext="properties" data-title="properties" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">config {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	# è¿™é‡Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨nacos</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # fileã€nacos ã€apolloã€zkã€consulã€etcd3</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">  type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  nacos {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  	# è·Ÿä¸Šé¢ä¸€æ ·çš„é…æ³•</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    serverAddr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;127.0.0.1:8848&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;89fc2145-4676-48b8-9edd-29e867879bcb&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;SEATA_GROUP&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;nacos&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    # è¿™ä¸ªä¸ç”¨æ”¹ï¼Œé»˜è®¤å°±è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">    dataId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;seataServer.properties&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦å°†é…ç½®å¯¼å…¥åˆ°Nacosä¸­ï¼Œæˆ‘ä»¬æ‰“å¼€ä¸€å¼€å§‹ä¸‹è½½çš„æºç <code>script/config-center/nacos</code>ç›®å½•ï¼Œè¿™æ˜¯å®˜æ–¹æä¾›çš„ä¸Šä¼ è„šæœ¬ï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œå³å¯ï¼ˆwindowsä¸‹æ²¡å¯¹åº”çš„batå°±å¾ˆè›‹ç–¼ï¼Œå¯ä»¥ä½¿ç”¨gitå‘½ä»¤è¡Œæ¥è¿è¡Œä¸€ä¸‹ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå¯äº¤äº’çš„ç‰ˆæœ¬ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/1tPwBFn7u3ScCeY.png" alt="image-20230306233500474" tabindex="0" loading="lazy"><figcaption>image-20230306233500474</figcaption></figure><p>æŒ‰ç…§æç¤ºè¾“å…¥å°±å¯ä»¥äº†ï¼Œä¸è¾“å…¥å°±ä½¿ç”¨çš„é»˜è®¤å€¼ï¼Œä¸çŸ¥é“ä¸ºå•¥æœ€æ–°ç‰ˆæœ¬æœ‰å››ä¸ªå› ä¸ºå‚æ•°è¿‡é•¿è¿˜å¯¼å…¥å¤±è´¥äº†ï¼Œå°±ç¦»è°±ï¼Œä¸è¿‡ä¸å½±å“ã€‚</p><p>å¯¼å…¥æˆåŠŸä¹‹åï¼Œå¯ä»¥åœ¨å¯¹åº”çš„å‘½åç©ºé—´ä¸‹çœ‹åˆ°å¯¹åº”çš„é…ç½®ï¼ˆä¸ºå•¥éè¦ä¸€ä¸ªä¸€ä¸ªé…ç½®é¡¹å•ç‹¬æï¼Œå°±ä¸èƒ½å†™ä¸€èµ·å—ï¼‰ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/8yTQGZluYVe1cg2.png" alt="image-20230306233510973" tabindex="0" loading="lazy"><figcaption>image-20230306233510973</figcaption></figure><p>æ³¨æ„ï¼Œè¿˜æ²¡å®Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å¯¹åº”çš„äº‹åŠ¡ç»„æ˜ å°„é…ç½®ä¹Ÿæ·»åŠ ä¸Šï¼ŒDataIdæ ¼å¼ä¸º<code>service.vgroupMapping.äº‹åŠ¡ç»„åç§°</code>ï¼Œæ¯”å¦‚æˆ‘ä»¬å°±ä½¿ç”¨é»˜è®¤çš„åç§°ï¼Œå€¼å…¨éƒ¨ä¾ç„¶ä½¿ç”¨defaultå³å¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/UBchb4zPjHAfCSs.png" alt="image-20230306233521002" tabindex="0" loading="lazy"><figcaption>image-20230306233521002</figcaption></figure><p>ç°åœ¨æˆ‘ä»¬å°±å®Œæˆäº†æœåŠ¡ç«¯çš„Nacosé…ç½®ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å¯¹å®¢æˆ·ç«¯ä¹Ÿè¿›è¡ŒNacosé…ç½®ï¼š</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	# æ³¨å†Œ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  registry</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  	# ä½¿ç”¨Nacos</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    	# ä½¿ç”¨Seataçš„å‘½åç©ºé—´ï¼Œè¿™æ ·æ‰èƒ½æ­£ç¡®æ‰¾åˆ°SeataæœåŠ¡ï¼Œç”±äºç»„ä½¿ç”¨çš„æ˜¯SEATA_GROUPï¼Œé…ç½®é»˜è®¤å€¼å°±æ˜¯ï¼Œå°±ä¸ç”¨é…äº†</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">89fc2145-4676-48b8-9edd-29e867879bcb</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  # é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">89fc2145-4676-48b8-9edd-29e867879bcb</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">nacos</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨è¿™ä¸‰ä¸ªæœåŠ¡äº†ï¼Œå¯ä»¥åœ¨Nacosä¸­çœ‹åˆ°Seataä»¥åŠä¸‰ä¸ªæœåŠ¡éƒ½æ­£å¸¸æ³¨å†Œäº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/PSbw5TFhm74Wu3n.png" alt="image-20230306233529255" tabindex="0" loading="lazy"><figcaption>image-20230306233529255</figcaption></figure><figure><img src="https://s2.loli.net/2023/03/06/nZUcuM2kJ86zgBv.png" alt="image-20230306233538630" tabindex="0" loading="lazy"><figcaption>image-20230306233538630</figcaption></figure><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥è®¿é—®ä¸€ä¸‹æœåŠ¡è¯•è¯•çœ‹äº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/Fn3R2Jrq1YyleCh.png" alt="image-20230306233545257" tabindex="0" loading="lazy"><figcaption>image-20230306233545257</figcaption></figure><p>å¯ä»¥çœ‹åˆ°æ•ˆæœå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä»¬çš„æ³¨å†Œå’Œé…ç½®éƒ½ç»§æ‰¿åœ¨Nacosä¸­è¿›è¡Œäº†ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥é…ç½®ä¸€ä¸‹äº‹åŠ¡ä¼šè¯ä¿¡æ¯çš„å­˜å‚¨æ–¹å¼ï¼Œé»˜è®¤æ˜¯fileç±»å‹ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¿è¡Œç›®å½•ä¸‹åˆ›å»º<code>file_store</code>ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ¬åˆ°æ•°æ®åº“ä¸­å­˜å‚¨ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®å³å¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/Cph9zPF2kaSvKdY.png" alt="image-20230306233553931" tabindex="0" loading="lazy"><figcaption>image-20230306233553931</figcaption></figure><p>å°†<code>store.session.mode</code>å’Œ<code>store.mode</code>çš„å€¼ä¿®æ”¹ä¸º<code>db</code></p><p>æ¥ç€æˆ‘ä»¬å¯¹æ•°æ®åº“ä¿¡æ¯è¿›è¡Œä¸€ä¸‹é…ç½®ï¼š</p><ul><li>æ•°æ®åº“é©±åŠ¨</li><li>æ•°æ®åº“URL</li><li>æ•°æ®åº“ç”¨æˆ·åå¯†ç </li></ul><p>å…¶ä»–çš„é»˜è®¤å³å¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/dlmYNnARZaxJ5MH.png" alt="image-20230306233612224" tabindex="0" loading="lazy"><figcaption>image-20230306233612224</figcaption></figure><p>æ¥ç€æˆ‘ä»¬éœ€è¦å°†å¯¹åº”çš„æ•°æ®åº“è¿›è¡Œåˆ›å»ºï¼Œåˆ›å»ºseataæ•°æ®åº“ï¼Œç„¶åç›´æ¥CVä»¥ä¸‹è¯­å¥ï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- -------------------------------- The script used when storeMode is &#39;db&#39; --------------------------------</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- the table to store GlobalSession data</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `global_table`</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `xid`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                       VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `transaction_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            BIGINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `status`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                    TINYINT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `application_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `transaction_service_group`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `transaction_name`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">          VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `timeout`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                   INT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `begin_time`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                BIGINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `application_data`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">          VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `gmt_create`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                DATETIME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `gmt_modified`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">              DATETIME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`xid`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `idx_status_gmt_modified`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`status`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`gmt_modified`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `idx_transaction_id`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`transaction_id`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- the table to store BranchSession data</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `branch_table`</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `branch_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">         BIGINT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `xid`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">               VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `transaction_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    BIGINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `resource_group_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `resource_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `branch_type`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `status`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            TINYINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `client_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">         VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `application_data`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `gmt_create`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        DATETIME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `gmt_modified`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      DATETIME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`branch_id`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `idx_xid`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`xid`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- the table to store lock data</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `lock_table`</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `row_key`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `xid`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `transaction_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> BIGINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `branch_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      BIGINT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `resource_id`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `table_name`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `pk`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">             VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">36</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `status`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">         TINYINT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      NOT NULL</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;0:locked ,1:rollbacking&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `gmt_create`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     DATETIME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `gmt_modified`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   DATETIME</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`row_key`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `idx_status`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`status`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `idx_branch_id`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`branch_id`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `distributed_lock`</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `lock_key`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">       CHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `lock_value`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">     VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `expire`</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">         BIGINT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    primary key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">`lock_key`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `distributed_lock`</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (lock_key, lock_value, expire) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;HandleAllSession&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://s2.loli.net/2023/03/06/7zvewSLhFmbc8G1.png" alt="image-20230306233627086" tabindex="0" loading="lazy"><figcaption>image-20230306233627086</figcaption></figure><p>å®Œæˆä¹‹åï¼Œé‡å¯SeataæœåŠ¡ç«¯å³å¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/G7qQoEy8DCX9bLJ.png" alt="image-20230306233752098" tabindex="0" loading="lazy"><figcaption>image-20230306233752098</figcaption></figure><p>çœ‹åˆ°äº†æ•°æ®æºåˆå§‹åŒ–æˆåŠŸï¼Œç°åœ¨å·²ç»åœ¨ä½¿ç”¨æ•°æ®åº“è¿›è¡Œä¼šè¯å­˜å‚¨äº†ã€‚</p><p>å¦‚æœSeataæœåŠ¡ç«¯å‡ºç°æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰äº‹åŠ¡ç»„çš„åç§°å¤ªé•¿äº†ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/qoNhgzM2PXpZU9B.png" alt="image-20230306233933641" tabindex="0" loading="lazy"><figcaption>image-20230306233933641</figcaption></figure><p>å°†<code>globle_table</code>è¡¨çš„å­—æ®µ<code>transaction_server_group</code>é•¿åº¦é€‚å½“å¢åŠ ä¸€ä¸‹å³å¯ï¼š</p><figure><img src="https://s2.loli.net/2023/03/06/9LnaoUxHzlY1GdV.png" alt="image-20230306233940850" tabindex="0" loading="lazy"><figcaption>image-20230306233940850</figcaption></figure><p>åˆ°æ­¤ï¼Œå…³äºåŸºäºnacosæ¨¡å¼ä¸‹çš„Seataéƒ¨ç½²ï¼Œå°±å®Œæˆäº†ã€‚</p><p>è™½ç„¶æˆ‘ä»¬è¿™é‡Œå®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†æ˜¯è¿˜æ˜¯ç»™å„ä½åŒå­¦æå‡ºä¸€ä¸ªé—®é¢˜ï¼ˆå¯ä»¥æŠŠè‡ªå·±æ‰€è®¤ä¸ºçš„ç»“æœæ‰“åœ¨å¼¹å¹•ä¸Šï¼‰ï¼Œå°±æˆ‘ä»¬ç›®å‰è¿™æ ·çš„ç¨‹åºè®¾è®¡ï¼Œåœ¨é«˜å¹¶å‘ä¸‹ï¼ŒçœŸçš„å®‰å…¨å—ï¼Ÿæ¯”å¦‚åŒä¸€æ—¶é—´100ä¸ªåŒå­¦æŠ¢åŒä¸€ä¸ªä¹¦ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“åŒä¸€ä¸ªä¹¦å°±åªæœ‰3æœ¬ï¼Œå¦‚æœè¿™æ—¶çœŸçš„åŒæ—¶æ¥äº†100ä¸ªè¯·æ±‚è¦å€Ÿä¹¦ï¼Œä¼šæ­£å¸¸åœ°åªå€Ÿå‡º3æœ¬ä¹¦å—ï¼Ÿå¦‚æœä¸æ­£å¸¸ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºæŸç çŸ¥è¯†åº“ç‰ˆæƒæ‰€æœ‰ï¼Œç¦æ­¢ä¸€åˆ‡æœªç»æˆæƒçš„è½¬è½½ã€å‘å¸ƒã€å‡ºå”®ç­‰è¡Œä¸ºï¼Œè¿è€…å°†è¢«è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://www.itbaima.cn/document/35v1hbsfcdgagdnw</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/doc/åˆ†å¸ƒå¼/cloud/SpringCloud 2.md" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/doc/%E5%88%86%E5%B8%83%E5%BC%8F/cloud/SpringCloud%201.html" aria-label="SpringCloud 1"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->SpringCloud 1</div></a><a class="route-link auto-link next" href="/doc/%E5%88%86%E5%B8%83%E5%BC%8F/cloud/SpringCloud%203.html" aria-label="SpringCloud 3"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">SpringCloud 3<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">é»˜è®¤é¡µè„š</div><div class="vp-copyright">Copyright Â© 2024 Cotton Eye Joe </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-7V2lPg4G.js" defer></script>
  </body>
</html>
